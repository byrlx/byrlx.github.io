<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2017-03-16 Thu 00:39 -->
<meta  http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta  name="viewport" content="width=device-width, initial-scale=1" />
<title>【翻译】当我开始Android开发时，希望能早点认识的一些开源库</title>
<meta  name="generator" content="Org-mode" />
<meta  name="author" content="Luis Xu" />
<link rel="stylesheet" title="Standard" href="/style/worg.css" type="text/css" />
<link rel="alternate stylesheet" title="Zenburn" href="/style/worg-zenburn.css" type="text/css" />
<link rel="alternate stylesheet" title="Classic" href="/style/worg-classic.css" type="text/css" />
<link rel="SHORTCUT ICON" href="/org-mode-unicorn.ico" type="image/x-icon" />
<link rel="icon" href="/org-mode-unicorn.ico" type="image/ico" />
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2013 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
</head>
<body>
<div id="preamble" class="status">
<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-7691209-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

  document.addEventListener('DOMContentLoaded',function() {
      document.getElementById("table-of-contents").onclick = function() {
          var elem = document.getElementById("text-table-of-contents");
          elem.style.display = elem.style.display == "block" ? "none" : "block";
      }
  });
</script>
</div>
<div id="content">
<h1 class="title">【翻译】当我开始Android开发时，希望能早点认识的一些开源库</h1>
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#orgheadline1">第一步：构造、使用view - Butter Knife</a>
<ul>
<li><a href="#orgheadline2">基本使用</a></li>
<li><a href="#orgheadline3">绑定、解绑fragment中的view</a></li>
<li><a href="#orgheadline4">注册监听函数</a></li>
<li><a href="#orgheadline5">绑定资源</a></li>
<li><a href="#orgheadline6">给多个组件设置同一个监听函数</a></li>
<li><a href="#orgheadline7">操作view的属性</a></li>
</ul>
</li>
<li><a href="#orgheadline8">第二步：加载网络图片 - Picasso</a>
<ul>
<li><a href="#orgheadline9">基本介绍</a></li>
<li><a href="#orgheadline10">更多特性</a></li>
<li><a href="#orgheadline11">一个完整的代码片段</a></li>
</ul>
</li>
<li><a href="#orgheadline12">第三步: json转换 - Gson</a>
<ul>
<li><a href="#orgheadline13">基本介绍</a></li>
<li><a href="#orgheadline14">高级用法</a></li>
</ul>
</li>
<li><a href="#orgheadline15">第四步: 请求网络数据 - Retrofit (请不要再使用AsyncTask了, 真的, 停下来吧)</a>
<ul>
<li><a href="#orgheadline16">基本介绍</a></li>
<li><a href="#orgheadline17">典型使用</a></li>
<li><a href="#orgheadline18">小技巧</a></li>
</ul>
</li>
<li><a href="#orgheadline19">第五步: 存储数据 - Realm (sqlite的替代品)</a>
<ul>
<li><a href="#orgheadline20">基本介绍</a></li>
<li><a href="#orgheadline21">一些特性</a></li>
</ul>
</li>
<li><a href="#orgheadline22">番外篇: 简便启动activity - Dart + Henson</a>
<ul>
<li><a href="#orgheadline23">基本用法</a></li>
</ul>
</li>
</ul>
</div>
</div>
<p>
原文地址 <a href="https://speakerdeck.com/chrisguzman/android-libraries-i-wish-i-knew-when-i-started">https://speakerdeck.com/chrisguzman/android-libraries-i-wish-i-knew-when-i-started</a>
</p>

<p>
介绍：当从事App开发时，有时候没必要重复造轮子，尤其是对新手而言。 
这个演讲涵盖了一些可以在App开发时使用的库，这些库可以解决你正在遇到的问题。
无论是要从Web接口获取数据， 或者显示、缓存图片， 或者存储、同步数据，
这些库都可以帮助你。 
</p>

<p>
本文是翻译的Groupon工程师<a href="https://speakerdeck.com/chrisguzman">Chris Guzman</a>的一个演讲PPT。作者以一个45分钟“hackathon”的方式，
从零开始构造一个App "TAaSKY", 这个App用于展示做"土豆"的食谱.
作者逐步介绍在开发这个app过程中使用到的开源库。
</p>

<div id="outline-container-orgheadline1" class="outline-2">
<h2 id="orgheadline1">第一步：构造、使用view - Butter Knife</h2>
<div class="outline-text-2" id="text-orgheadline1">
<p>
这一步是用来构造TAaSKY应用的UI界面.
</p>
</div>
<div id="outline-container-orgheadline2" class="outline-3">
<h3 id="orgheadline2">基本使用</h3>
<div class="outline-text-3" id="text-orgheadline2">
<p>
下面的内容是activity的一个简略的layout文件，这是开发App过程中
必不可少的东西，当写完layout之后，大部分情况下都需要在代码中
引用相关的组件。这里就可以使用在Android领域举世闻名的开源库：
Butter Knife。
</p>

<div class="org-src-container">

<pre class="src src-java">&lt;LinearLayout ... android:orientation=<span style="color: #CC9393;">"vertical"</span>&gt;
&lt;ImageView android:id=<span style="color: #CC9393;">"@+id/taco_img"</span> .../&gt;
&lt;TextView android:id=<span style="color: #CC9393;">"@+id/description"</span> .../&gt;
&lt;LinearLayout android:orientation=<span style="color: #CC9393;">"horizontal"</span> .../&gt;
&lt;Button android:id=<span style="color: #CC9393;">"@+id/reject"</span> .../&gt;
&lt;Button android:id=<span style="color: #CC9393;">"@+id/info"</span> .../&gt;
&lt;Button android:id=<span style="color: #CC9393;">"@+id/save"</span> .../&gt;
&lt;/LinearLayout&gt;
&lt;EditText android:id=<span style="color: #CC9393;">"@+id/tag"</span> .../&gt;
&lt;/LinearLayout&gt;
</pre>
</div>

<p>
Butter Knife通过注解的方式将代码和xml文件绑定到一起，无需在
重复写大量的 <code>findViewById()</code> 这种代码。该库有以下几个优势：
</p>
<ol class="org-ol">
<li>没有拖慢程序速度。</li>
<li>改善view查找。</li>
<li>改善监听函数注册。</li>
<li>改善资源查找。</li>
</ol>
<div class="org-src-container">

<pre class="src src-java">&lt;TextView android:id=<span style="color: #CC9393;">"@+id/description"</span>
 ...
 /&gt;
<span style="color: #F0DFAF; font-weight: bold;">public</span> <span style="color: #F0DFAF; font-weight: bold;">class</span> MainActivity <span style="color: #F0DFAF; font-weight: bold;">extends</span> <span style="color: #7CB8BB;">Activity</span> {
   <span style="color: #BFEBBF;">@BindView</span>(R.id.<span style="color: #7CB8BB;">description</span>) <span style="color: #7CB8BB;">TextView</span> <span style="color: #DFAF8F;">description</span>;

   <span style="color: #BFEBBF;">@Override</span>
   <span style="color: #F0DFAF; font-weight: bold;">protected</span> <span style="color: #7CB8BB;">void</span> <span style="color: #93E0E3;">onCreate</span>(<span style="color: #7CB8BB;">Bundle</span> <span style="color: #DFAF8F;">bundle</span>) {
      ...
      ButterKnife.bind(<span style="color: #F0DFAF; font-weight: bold;">this</span>);
      description.setText(<span style="color: #CC9393;">"Tofu with Cheese on a tortilla"</span>);
   }
}
</pre>
</div>
<p>
下面是一个通常的Butter Knife用法, <code>ButterKnife.bind(this)</code> 函数
会自动生成代码寻找相关的view、资源并把它们保存到activity代码中。
类似这样：
</p>
<div class="org-src-container">

<pre class="src src-java"><span style="color: #F0DFAF; font-weight: bold;">public</span> <span style="color: #7CB8BB;">void</span> <span style="color: #93E0E3;">bind</span>(<span style="color: #7CB8BB;">MainActivity</span> <span style="color: #DFAF8F;">activity</span>) {
   activity.description = (<span style="color: #BFEBBF;">android</span>.<span style="color: #BFEBBF;">widget</span>.<span style="color: #7CB8BB;">TextView</span>) activity.findViewById(2130968577);
}
</pre>
</div>

<p>
下面是一些更高级的用法：
</p>
</div>
</div>
<div id="outline-container-orgheadline3" class="outline-3">
<h3 id="orgheadline3">绑定、解绑fragment中的view</h3>
<div class="outline-text-3" id="text-orgheadline3">
<div class="org-src-container">

<pre class="src src-java"><span style="color: #F0DFAF; font-weight: bold;">public</span> <span style="color: #F0DFAF; font-weight: bold;">class</span> <span style="color: #7CB8BB;">TacoFragment</span> <span style="color: #F0DFAF; font-weight: bold;">extends</span> <span style="color: #7CB8BB;">Fragment</span> {
 <span style="color: #BFEBBF;">@BindView</span>(R.id.<span style="color: #7CB8BB;">tag</span>) <span style="color: #7CB8BB;">EditText</span> <span style="color: #DFAF8F;">tag</span>;
 <span style="color: #F0DFAF; font-weight: bold;">private</span> <span style="color: #7CB8BB;">Unbinder</span> <span style="color: #DFAF8F;">unbinder</span>;

 <span style="color: #BFEBBF;">@Override</span>
 <span style="color: #F0DFAF; font-weight: bold;">public</span> <span style="color: #7CB8BB;">View</span> <span style="color: #93E0E3;">onCreateView</span>(<span style="color: #7CB8BB;">LayoutInflater</span> <span style="color: #DFAF8F;">inflater</span>, <span style="color: #7CB8BB;">ViewGroup</span> <span style="color: #DFAF8F;">group</span>, <span style="color: #7CB8BB;">Bundle</span> <span style="color: #DFAF8F;">bundle</span>) {
      ...
      <span style="color: #5F7F5F;">//</span><span style="color: #7F9F7F;">Important!</span>
      unbinder = ButterKnife.bind(<span style="color: #F0DFAF; font-weight: bold;">this</span>, parentView);
      tag.setHint(<span style="color: #CC9393;">"Add tag. Eg: Tasty!, Want to try"</span>)
      <span style="color: #F0DFAF; font-weight: bold;">return</span> view;
 }

 <span style="color: #BFEBBF;">@Override</span>
 <span style="color: #F0DFAF; font-weight: bold;">public</span> <span style="color: #7CB8BB;">void</span> <span style="color: #93E0E3;">onDestroyView</span>() {
      <span style="color: #F0DFAF; font-weight: bold;">super</span>.onDestroyView();
      <span style="color: #5F7F5F;">//</span><span style="color: #7F9F7F;">sets the views to null</span>
      unbinder.unbind();
 }
}
</pre>
</div>
</div>
</div>
<div id="outline-container-orgheadline4" class="outline-3">
<h3 id="orgheadline4">注册监听函数</h3>
<div class="outline-text-3" id="text-orgheadline4">
<p>
ButterKnife支持大部分常用的监听函数。
</p>
<div class="org-src-container">

<pre class="src src-java"><span style="color: #BFEBBF;">@OnClick</span>(R.id.<span style="color: #7CB8BB;">save</span>)
<span style="color: #F0DFAF; font-weight: bold;">public</span> <span style="color: #7CB8BB;">void</span> <span style="color: #93E0E3;">saveTaco</span>(<span style="color: #7CB8BB;">Button</span> <span style="color: #DFAF8F;">button</span>) {
 button.setText(<span style="color: #CC9393;">"Saved!"</span>);
}
</pre>
</div>
</div>
</div>
<div id="outline-container-orgheadline5" class="outline-3">
<h3 id="orgheadline5">绑定资源</h3>
<div class="outline-text-3" id="text-orgheadline5">
<div class="org-src-container">

<pre class="src src-java"><span style="color: #F0DFAF; font-weight: bold;">class</span> <span style="color: #7CB8BB;">MainActivity</span> <span style="color: #F0DFAF; font-weight: bold;">extends</span> <span style="color: #7CB8BB;">Activity</span> {
 <span style="color: #BFEBBF;">@BindString</span>(R.string.<span style="color: #7CB8BB;">title</span>) <span style="color: #7CB8BB;">String</span> <span style="color: #DFAF8F;">title</span>;
 <span style="color: #BFEBBF;">@BindDrawable</span>(R.drawable.<span style="color: #7CB8BB;">star</span>) <span style="color: #7CB8BB;">Drawable</span> <span style="color: #DFAF8F;">star</span>;
 <span style="color: #5F7F5F;">// </span><span style="color: #7F9F7F;">int or ColorStateList</span>
 <span style="color: #BFEBBF;">@BindColor</span>(R.color.<span style="color: #7CB8BB;">guac_green</span>) <span style="color: #7CB8BB;">int</span> <span style="color: #DFAF8F;">guacGreen</span>;
 <span style="color: #5F7F5F;">// </span><span style="color: #7F9F7F;">int (in pixels) or float (for exact value)</span>
 <span style="color: #BFEBBF;">@BindDimen</span>(R.dimen.<span style="color: #7CB8BB;">spacer</span>) <span style="color: #7CB8BB;">Float</span> <span style="color: #DFAF8F;">spacer</span>;
}
</pre>
</div>
</div>
</div>
<div id="outline-container-orgheadline6" class="outline-3">
<h3 id="orgheadline6">给多个组件设置同一个监听函数</h3>
<div class="outline-text-3" id="text-orgheadline6">
<div class="org-src-container">

<pre class="src src-java"><span style="color: #BFEBBF;">@OnClick</span>({ R.id.save, R.id.reject})
<span style="color: #F0DFAF; font-weight: bold;">public</span> <span style="color: #7CB8BB;">void</span> <span style="color: #93E0E3;">actOnTaco</span>(<span style="color: #7CB8BB;">View</span> <span style="color: #DFAF8F;">view</span>) {
 <span style="color: #F0DFAF; font-weight: bold;">if</span> (view.getId() == R.reject) {
    Toast.makeText(<span style="color: #F0DFAF; font-weight: bold;">this</span>, <span style="color: #CC9393;">"Ew Gross!"</span>, LENGTH_SHORT).show();
 }
 <span style="color: #F0DFAF; font-weight: bold;">else</span> {
    Toast.makeText(<span style="color: #F0DFAF; font-weight: bold;">this</span>, <span style="color: #CC9393;">"Yummy :)"</span>, LENGTH_SHORT).show();
 }
 <span style="color: #5F7F5F;">//</span><span style="color: #7F9F7F;">TODO: implement</span>
 getNextTaco();
}
</pre>
</div>
</div>
</div>
<div id="outline-container-orgheadline7" class="outline-3">
<h3 id="orgheadline7">操作view的属性</h3>
<div class="outline-text-3" id="text-orgheadline7">
<div class="org-src-container">

<pre class="src src-java"><span style="color: #5F7F5F;">//</span><span style="color: #7F9F7F;">&#19979;&#38754;&#30340;&#20195;&#30721;&#23558;&#20004;&#20010;button&#32465;&#23450;&#21040;&#19968;&#20010;list&#20013;&#65292; &#24182;&#36890;&#36807;&#25805;&#20316;&#36825;&#20010;list&#26469;</span>
<span style="color: #5F7F5F;">//</span><span style="color: #7F9F7F;">&#25805;&#20316;&#36825;&#20123;&#25353;&#38062;&#30340;&#23646;&#24615;&#12290;</span>
<span style="color: #BFEBBF;">@BindViews</span>({R.id.save, R.id.reject})
<span style="color: #7CB8BB;">List</span>&lt;<span style="color: #7CB8BB;">Button</span>&gt; <span style="color: #DFAF8F;">actionButtons</span>;
ButterKnife.apply(actionButtons, <span style="color: #BFEBBF;">View</span>.ALPHA, 0.0f);

ButterKnife.apply(actionButtons, DISABLE);
ButterKnife.apply(actionButtons, ENABLED, <span style="color: #BFEBBF;">false</span>);
<span style="color: #F0DFAF; font-weight: bold;">static</span> <span style="color: #F0DFAF; font-weight: bold;">final</span> <span style="color: #BFEBBF;">ButterKnife</span>.<span style="color: #7CB8BB;">Action</span>&lt;<span style="color: #7CB8BB;">View</span>&gt; <span style="color: #DFAF8F;">DISABLE</span> = <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #BFEBBF;">ButterKnife</span>.<span style="color: #7CB8BB;">Action</span>&lt;<span style="color: #7CB8BB;">View</span>&gt;() {
 <span style="color: #BFEBBF;">@Override</span> <span style="color: #F0DFAF; font-weight: bold;">public</span> <span style="color: #7CB8BB;">void</span> <span style="color: #93E0E3;">apply</span>(<span style="color: #7CB8BB;">View</span> <span style="color: #DFAF8F;">view</span>, <span style="color: #7CB8BB;">int</span> <span style="color: #DFAF8F;">index</span>) {
    view.setEnabled(<span style="color: #BFEBBF;">false</span>);
 }
};
<span style="color: #F0DFAF; font-weight: bold;">static</span> <span style="color: #F0DFAF; font-weight: bold;">final</span> <span style="color: #BFEBBF;">ButterKnife</span>.<span style="color: #7CB8BB;">Setter</span>&lt;<span style="color: #7CB8BB;">View</span>, <span style="color: #7CB8BB;">Boolean</span>&gt; <span style="color: #DFAF8F;">ENABLED</span> = <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #BFEBBF;">ButterKnife</span>.<span style="color: #7CB8BB;">Setter</span>&lt;<span style="color: #7CB8BB;">View</span>, <span style="color: #7CB8BB;">Boolean</span>&gt;() {
 <span style="color: #BFEBBF;">@Override</span> <span style="color: #F0DFAF; font-weight: bold;">public</span> <span style="color: #7CB8BB;">void</span> <span style="color: #93E0E3;">set</span>(<span style="color: #7CB8BB;">View</span> <span style="color: #DFAF8F;">view</span>, <span style="color: #7CB8BB;">Boolean</span> <span style="color: #DFAF8F;">value</span>, <span style="color: #7CB8BB;">int</span> <span style="color: #DFAF8F;">index</span>) {
    view.setEnabled(value);
 }
};
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-orgheadline8" class="outline-2">
<h2 id="orgheadline8">第二步：加载网络图片 - Picasso</h2>
<div class="outline-text-2" id="text-orgheadline8">
<p>
这一步用于在应用显示土豆的照片, 照片可能是网络或本地图片.
</p>

<p>
通过<a href="#orgheadline1">第一步</a>的代码，UI部分基本已经写完了。然后接下来要实现APP的一个功能,
从网络下载图片并显示. 这里用到了一个同样有名的开源库: Picasso. <br  />
</p>
</div>
<div id="outline-container-orgheadline9" class="outline-3">
<h3 id="orgheadline9">基本介绍</h3>
<div class="outline-text-3" id="text-orgheadline9">
<p>
该库的一些特点包括:
</p>
<ol class="org-ol">
<li>进行HTTP请求.</li>
<li>缓存图片.</li>
<li>简单的"resize/裁剪/居中/放大"操作.</li>
<li>负责在主线程之外进行http请求.</li>
<li>对RecyclerView的view进行合理回收.</li>
</ol>
<p>
在介绍Picasso之前, 先看一下比较通用的"自己写"的下载图片代码:<br  />
这段代码通过http请求获取图片的stream, 然后再调用Android的BitmapFactory
类来将stream转化成bitmap. 其中 OpenHttpGETConnection()函数还要考虑在
子线程中进行http请求操作.
</p>
<div class="org-src-container">

<pre class="src src-java"><span style="color: #F0DFAF; font-weight: bold;">private</span> <span style="color: #7CB8BB;">Bitmap</span> <span style="color: #93E0E3;">DownloadImage</span>(<span style="color: #7CB8BB;">String</span> <span style="color: #DFAF8F;">url</span>)
{
 <span style="color: #7CB8BB;">Bitmap</span> <span style="color: #DFAF8F;">bitmap</span> = <span style="color: #BFEBBF;">null</span>;
 <span style="color: #7CB8BB;">InputStream</span> <span style="color: #DFAF8F;">in</span> = <span style="color: #BFEBBF;">null</span>;
 <span style="color: #F0DFAF; font-weight: bold;">try</span> {
    in = OpenHttpGETConnection(url);
    bitmap = BitmapFactory.decodeStream(in); in.close();
 } <span style="color: #F0DFAF; font-weight: bold;">catch</span> (<span style="color: #7CB8BB;">Exception</span> <span style="color: #DFAF8F;">e</span>) {
    Log.d(<span style="color: #CC9393;">"DownloadImage"</span>, e.getLocalizedMessage());
 }
 <span style="color: #F0DFAF; font-weight: bold;">return</span> bitmap;
}
</pre>
</div>

<p>
如果使用Picasso,则上面的代码就变为:
</p>
<div class="org-src-container">

<pre class="src src-java">Picasso.with(context)
 .load(<span style="color: #CC9393;">"http://placekitten.com/200/300"</span>)
 .into(imageView);
</pre>
</div>
</div>
</div>
<div id="outline-container-orgheadline10" class="outline-3">
<h3 id="orgheadline10">更多特性</h3>
<div class="outline-text-3" id="text-orgheadline10">
<p>
上面展示了Picasso的一个典型使用方式, 该库还包含其他的对图片的操作,
例如:
</p>
<ol class="org-ol">
<li>placeholder(R.mipmap.loading) 
占位图片, 可以是一个资源或者drawable</li>
<li>error(R.drawable.sad_taco) 
如果加载失败显示的图片</li>
<li>fit() //reduce the image size to the dimensions of imageView
将图片大小缩减到imageView的大小.</li>
<li>resize(imgWidth, imgHeight) //resizes the image in pixels
缩减到指定图片大小. 单位是px</li>
<li>centerCrop() //or .centerInside()
居中裁剪.</li>
<li>rotate(90f) 
旋转图片. 或者也可以使用函数 rotate(degrees, pivotX, pivotY)</li>
</ol>

<p>
除了网络下载图片, Picasso也支持加载本地图片. 例如下面的代码:
</p>
<div class="org-src-container">

<pre class="src src-java">Picasso.with(context).load(R.drawable.salsa).into(imageView1);
Picasso.with(context).load(<span style="color: #CC9393;">"file:///asset/salsa.png"</span>).into(imageView2);
Picasso.with(context).load(<span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">File</span>(...)).into(imageView3);
</pre>
</div>
</div>
</div>
<div id="outline-container-orgheadline11" class="outline-3">
<h3 id="orgheadline11">一个完整的代码片段</h3>
<div class="outline-text-3" id="text-orgheadline11">
<p>
下面是Picasso和ButterKnife一起用的场景, 在通过Picasso下载图片时, 使用
ButterKnife的apply函数来使按钮不可用. 
</p>
<div class="org-src-container">

<pre class="src src-java"><span style="color: #5F7F5F;">//</span><span style="color: #7F9F7F;">Butter Knife!</span>
<span style="color: #BFEBBF;">@BindView</span>(R.id.<span style="color: #7CB8BB;">taco_img</span>) <span style="color: #7CB8BB;">ImageView</span> <span style="color: #DFAF8F;">tacoImg</span>;
<span style="color: #F0DFAF; font-weight: bold;">private</span> <span style="color: #7CB8BB;">void</span> <span style="color: #93E0E3;">setTacoImage</span>() {
 Picasso.with(context)
 .load(<span style="color: #CC9393;">"http://tacoimages.com/random.jpg"</span>)
 .into(tacoImg);
}
<span style="color: #F0DFAF; font-weight: bold;">private</span> <span style="color: #7CB8BB;">void</span> <span style="color: #93E0E3;">getNextTaco</span>() {
 ButterKnife.apply(actionButtons, DISABLE);
 setTacoImage();
 <span style="color: #5F7F5F;">//</span><span style="color: #7F9F7F;">TODO: implement</span>
 loadTacoDescription();
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgheadline12" class="outline-2">
<h2 id="orgheadline12">第三步: json转换 - Gson</h2>
<div class="outline-text-2" id="text-orgheadline12">
<p>
这一步用于对服务器返回的json格式数据转化成类对象, 或者反过来.
</p>
</div>
<div id="outline-container-orgheadline13" class="outline-3">
<h3 id="orgheadline13">基本介绍</h3>
<div class="outline-text-3" id="text-orgheadline13">
<p>
Gson的一些特点:
</p>
<ol class="org-ol">
<li>(可以)不需要在类中使用注解.</li>
<li>性能好.</li>
<li>使用广泛.</li>
<li>默认包含类(包括父类)的所有域.</li>
<li>支持多维数组.</li>
<li>当序列化时, 类的值为null的变量会被跳过.</li>
<li>反序列化时, json中没有的域会在对象中生成一个null值.</li>
</ol>

<p>
例如下面的例子对类Taco使用Gson进行Json的序列化和反序列化.
</p>
<div class="org-src-container">

<pre class="src src-java"><span style="color: #F0DFAF; font-weight: bold;">class</span> <span style="color: #7CB8BB;">Taco</span> {
 <span style="color: #F0DFAF; font-weight: bold;">private</span> <span style="color: #7CB8BB;">String</span> <span style="color: #DFAF8F;">description</span>;
 <span style="color: #F0DFAF; font-weight: bold;">private</span> <span style="color: #7CB8BB;">String</span> <span style="color: #DFAF8F;">imageUrl</span>;
 <span style="color: #F0DFAF; font-weight: bold;">private</span> <span style="color: #7CB8BB;">String</span> <span style="color: #DFAF8F;">tag</span>;
 <span style="color: #5F7F5F;">//</span><span style="color: #7F9F7F;">not included in JSON serialization or deserialization</span>
 <span style="color: #F0DFAF; font-weight: bold;">private</span> <span style="color: #F0DFAF; font-weight: bold;">transient</span> <span style="color: #7CB8BB;">boolean</span> <span style="color: #DFAF8F;">favorite</span>;
 <span style="color: #93E0E3;">Taco</span>(<span style="color: #7CB8BB;">String</span> <span style="color: #DFAF8F;">description</span>, <span style="color: #7CB8BB;">String</span> <span style="color: #DFAF8F;">imageUrl</span>, <span style="color: #7CB8BB;">String</span> <span style="color: #DFAF8F;">tag</span>, <span style="color: #7CB8BB;">boolean</span> <span style="color: #DFAF8F;">favorite</span>) {
 ....
 }
}

<span style="color: #5F7F5F;">// </span><span style="color: #7F9F7F;">Serialize to JSON</span>
<span style="color: #7CB8BB;">Taco</span> <span style="color: #DFAF8F;">breakfastTaco</span> = <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">Taco</span>(<span style="color: #CC9393;">"Eggs with syrup on pancake"</span>, <span style="color: #CC9393;">"imgur.com/123"</span>, <span style="color: #CC9393;">"breakfast"</span>, <span style="color: #BFEBBF;">true</span>);
<span style="color: #7CB8BB;">Gson</span> <span style="color: #DFAF8F;">gson</span> = <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">Gson</span>();
<span style="color: #7CB8BB;">String</span> <span style="color: #DFAF8F;">json</span> = gson.toJson(breakfastTaco);
<span style="color: #5F7F5F;">// </span><span style="color: #7F9F7F;">==&gt; json is {description:"Eggs with syrup on pancake", imageUrl:"imgur.com/123", tag:"breakfast"}</span>
<span style="color: #5F7F5F;">// </span><span style="color: #7F9F7F;">Deserialize to POJO</span>
<span style="color: #7CB8BB;">Taco</span> <span style="color: #DFAF8F;">yummyTaco</span> = gson.fromJson(json, Taco.<span style="color: #F0DFAF; font-weight: bold;">class</span>);
<span style="color: #5F7F5F;">// </span><span style="color: #7F9F7F;">==&gt; yummyTaco is just like breakfastTaco except for the favorite boolean</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-orgheadline14" class="outline-3">
<h3 id="orgheadline14">高级用法</h3>
<div class="outline-text-3" id="text-orgheadline14">
<ol class="org-ol">
<li><p>
如果变量名和json的域名不同, 可以使用 <code>@SerializeName()</code> 注解修饰.
</p>
<div class="org-src-container">

<pre class="src src-java"><span style="color: #F0DFAF; font-weight: bold;">public</span> <span style="color: #F0DFAF; font-weight: bold;">class</span> <span style="color: #7CB8BB;">Taco</span> {
    <span style="color: #BFEBBF;">@SerializedName</span>(<span style="color: #CC9393;">"serialized_labels"</span>)
    <span style="color: #F0DFAF; font-weight: bold;">private</span> <span style="color: #7CB8BB;">String</span> <span style="color: #DFAF8F;">tag</span>;
}
</pre>
</div></li>
<li><p>
通过Gson的API客制化输出.
</p>
<div class="org-src-container">

<pre class="src src-java">   <span style="color: #5F7F5F;">//</span><span style="color: #7F9F7F;">&#22914;&#26524;&#21464;&#37327;&#20540;&#20026;null,&#21017;&#36755;&#20986;&#20013;&#20063;&#36755;&#20986;null,&#32780;&#19981;&#26159;&#24573;&#30053;.</span>
<span style="color: #7CB8BB;">Gson</span> <span style="color: #DFAF8F;">gson</span> = <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">GsonBuilder</span>().serializeNulls().create();
<span style="color: #5F7F5F;">//</span><span style="color: #7F9F7F;">&#20445;&#30041;&#31354;&#26684;</span>
<span style="color: #7CB8BB;">Gson</span> <span style="color: #DFAF8F;">gson</span> = <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">GsonBuilder</span>().setPrettyPrinting().create();
</pre>
</div></li>
<li><p>
设置日期格式
</p>
<div class="org-src-container">

<pre class="src src-java"><span style="color: #F0DFAF; font-weight: bold;">public</span> <span style="color: #7CB8BB;">String</span> <span style="color: #DFAF8F;">DATE_FORMAT</span> = <span style="color: #CC9393;">"yyyy-MM-dd"</span>;
<span style="color: #7CB8BB;">GsonBuilder</span> <span style="color: #DFAF8F;">gsonBuilder</span> = <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">GsonBuilder</span>();
gsonBuilder.setDateFormat(DATE_FORMAT);
<span style="color: #7CB8BB;">Gson</span> <span style="color: #DFAF8F;">gson</span> = gsonBuilder.create();
</pre>
</div></li>
</ol>
</div>
</div>
</div>
<div id="outline-container-orgheadline15" class="outline-2">
<h2 id="orgheadline15">第四步: 请求网络数据 - Retrofit (请不要再使用AsyncTask了, 真的, 停下来吧)</h2>
<div class="outline-text-2" id="text-orgheadline15">
<p>
这一步用于从服务器上获取数据.
</p>
</div>
<div id="outline-container-orgheadline16" class="outline-3">
<h3 id="orgheadline16">基本介绍</h3>
<div class="outline-text-3" id="text-orgheadline16">
<p>
Retrofit的一些特点:
</p>
<ol class="org-ol">
<li>类型安全.</li>
<li>支持认证.</li>
<li>支持json的序列化和反序列化.</li>
<li>支持RxJava</li>
<li>支持同步和异步请求.</li>
</ol>
</div>
</div>
<div id="outline-container-orgheadline17" class="outline-3">
<h3 id="orgheadline17">典型使用</h3>
<div class="outline-text-3" id="text-orgheadline17">
<p>
下面是Retrofit的一个典型应用, (更多介绍可以看<a href="../retrofit.html">这里</a>):
</p>
<ol class="org-ol">
<li>定义API</li>
</ol>
<div class="org-src-container">

<pre class="src src-java"><span style="color: #F0DFAF; font-weight: bold;">public</span> <span style="color: #F0DFAF; font-weight: bold;">interface</span> <span style="color: #7CB8BB;">TacoApi</span> {
 <span style="color: #5F7F5F;">// </span><span style="color: #7F9F7F;">Request method and URL specified in the annotation</span>
 <span style="color: #5F7F5F;">// </span><span style="color: #7F9F7F;">Callback for the parsed response is the last parameter</span>
 <span style="color: #BFEBBF;">@GET</span>(<span style="color: #CC9393;">"random/"</span>)
 <span style="color: #7CB8BB;">Call</span>&lt;<span style="color: #7CB8BB;">Taco</span>&gt; <span style="color: #93E0E3;">randomTaco</span>(<span style="color: #BFEBBF;">@Query</span>(<span style="color: #CC9393;">"full-taco"</span>) <span style="color: #7CB8BB;">boolean</span> <span style="color: #DFAF8F;">full</span>);
 <span style="color: #BFEBBF;">@GET</span>(<span style="color: #CC9393;">"contributions/"</span>)
 <span style="color: #7CB8BB;">Call</span>&lt;<span style="color: #7CB8BB;">List</span>&lt;<span style="color: #7CB8BB;">Contributor</span>&gt;&gt; <span style="color: #93E0E3;">getContributors</span>();
 <span style="color: #BFEBBF;">@GET</span>(<span style="color: #CC9393;">"contributions/{name}"</span>)
 <span style="color: #7CB8BB;">Call</span>&lt;<span style="color: #7CB8BB;">Contributor</span>&gt; <span style="color: #93E0E3;">getContributors</span>(<span style="color: #BFEBBF;">@Path</span>(<span style="color: #CC9393;">"name"</span>) <span style="color: #7CB8BB;">String</span> <span style="color: #DFAF8F;">username</span>));
 <span style="color: #BFEBBF;">@POST</span>(<span style="color: #CC9393;">"recipe/new"</span>)
 <span style="color: #7CB8BB;">Call</span>&lt;<span style="color: #7CB8BB;">Recipe</span>&gt; <span style="color: #93E0E3;">createRecipe</span>(<span style="color: #BFEBBF;">@Body</span> <span style="color: #7CB8BB;">Recipe</span> <span style="color: #DFAF8F;">recipe</span>);
}
</pre>
</div>
<ol class="org-ol">
<li>使用api进行请求
<ol class="org-ol">
<li><p>
同步请求:
</p>
<div class="org-src-container">

<pre class="src src-java"><span style="color: #7CB8BB;">Retrofit</span> <span style="color: #DFAF8F;">retrofit</span> = <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #BFEBBF;">Retrofit</span>.<span style="color: #7CB8BB;">Builder</span>()
    .baseUrl(<span style="color: #CC9393;">"http://taco-randomizer.herokuapp.com/"</span>)
    .addConverterFactory(GsonConverterFactory.create())
    .build();

    <span style="color: #5F7F5F;">// </span><span style="color: #7F9F7F;">&#21019;&#24314;api&#23454;&#20363;</span>
    <span style="color: #7CB8BB;">TacoApi</span> <span style="color: #DFAF8F;">tacoApi</span> = retrofit.create(TacoApi.<span style="color: #F0DFAF; font-weight: bold;">class</span>);
    <span style="color: #5F7F5F;">// </span><span style="color: #7F9F7F;">&#21019;&#24314;&#35831;&#27714;</span>
    <span style="color: #7CB8BB;">Call</span>&lt;<span style="color: #7CB8BB;">Taco</span>&gt; <span style="color: #DFAF8F;">call</span> = tacoApi.randomTaco(<span style="color: #BFEBBF;">true</span>);
    <span style="color: #5F7F5F;">// </span><span style="color: #7F9F7F;">&#25191;&#34892;&#35831;&#27714;</span>
    <span style="color: #7CB8BB;">Taco</span> <span style="color: #DFAF8F;">taco</span> = call.execute().body();
</pre>
</div></li>

<li><p>
异步请求
</p>
<div class="org-src-container">

<pre class="src src-java"><span style="color: #7CB8BB;">Recipe</span> <span style="color: #DFAF8F;">recipe</span> = <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">Recipe</span>();
<span style="color: #7CB8BB;">Call</span>&lt;<span style="color: #7CB8BB;">Recipe</span>&gt; <span style="color: #DFAF8F;">call</span> = tacoApi.createRecipe(recipe);
call.enqueue(<span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">Callback</span>&lt;<span style="color: #7CB8BB;">Recipe</span>&gt;() {
    <span style="color: #BFEBBF;">@Override</span>
    <span style="color: #F0DFAF; font-weight: bold;">public</span> <span style="color: #7CB8BB;">void</span> <span style="color: #93E0E3;">onResponse</span>(<span style="color: #7CB8BB;">Call</span>&lt;<span style="color: #7CB8BB;">Recipe</span>&gt; <span style="color: #DFAF8F;">call</span>, <span style="color: #7CB8BB;">Response</span>&lt;<span style="color: #7CB8BB;">Recipe</span>&gt; <span style="color: #DFAF8F;">response</span>) {}
    <span style="color: #BFEBBF;">@Override</span>
    <span style="color: #F0DFAF; font-weight: bold;">public</span> <span style="color: #7CB8BB;">void</span> <span style="color: #93E0E3;">onFailure</span>(<span style="color: #7CB8BB;">Call</span>&lt;<span style="color: #7CB8BB;">Recipe</span>&gt; <span style="color: #DFAF8F;">call</span>, <span style="color: #7CB8BB;">Throwable</span> <span style="color: #DFAF8F;">t</span>) {}
</pre>
</div></li>
</ol></li>
</ol>
</div>
</div>

<div id="outline-container-orgheadline18" class="outline-3">
<h3 id="orgheadline18">小技巧</h3>
<div class="outline-text-3" id="text-orgheadline18">
<ol class="org-ol">
<li><p>
通过注解修改请求的url
</p>
<div class="org-src-container">

<pre class="src src-java"><span style="color: #BFEBBF;">@POST</span>(<span style="color: #CC9393;">"http://taco-randomizer.herokuapp.com/v2/taco"</span>)
<span style="color: #F0DFAF; font-weight: bold;">private</span> <span style="color: #7CB8BB;">Call</span>&lt;<span style="color: #7CB8BB;">Taco</span>&gt; <span style="color: #93E0E3;">getFromNewAPI</span>();
</pre>
</div></li>
<li><p>
添加请求头部
</p>
<div class="org-src-container">

<pre class="src src-java"><span style="color: #BFEBBF;">@Headers</span>({<span style="color: #CC9393;">"User-Agent: tacobot"</span>})
<span style="color: #BFEBBF;">@GET</span>(<span style="color: #CC9393;">"contributions/"</span>)
<span style="color: #F0DFAF; font-weight: bold;">private</span> <span style="color: #7CB8BB;">Call</span>&lt;<span style="color: #7CB8BB;">List</span>&lt;<span style="color: #7CB8BB;">Contributor</span>&gt;&gt; <span style="color: #93E0E3;">getContributors</span>();
</pre>
</div></li>
</ol>
</div>
</div>
</div>
<div id="outline-container-orgheadline19" class="outline-2">
<h2 id="orgheadline19">第五步: 存储数据 - Realm (sqlite的替代品)</h2>
<div class="outline-text-2" id="text-orgheadline19">
<p>
这一步用于将服务器返回的数据(如食谱)存储起来.
</p>
</div>
<div id="outline-container-orgheadline20" class="outline-3">
<h3 id="orgheadline20">基本介绍</h3>
<div class="outline-text-3" id="text-orgheadline20">
<p>
Realm的一些特点:
</p>
<ol class="org-ol">
<li>为手机而生.</li>
<li>可以快到使用同步.</li>
<li>支持一个应用包含多个Realm数据库.(Sqlite只有一个).</li>
</ol>

<p>
下面是Realm在App中的应用实例:
</p>
<ol class="org-ol">
<li><p>
需要持久化的类需要继承RealmObject:
</p>
<div class="org-src-container">

<pre class="src src-java"><span style="color: #F0DFAF; font-weight: bold;">public</span> <span style="color: #F0DFAF; font-weight: bold;">class</span> <span style="color: #7CB8BB;">Taco</span> <span style="color: #F0DFAF; font-weight: bold;">extends</span> <span style="color: #7CB8BB;">RealmObject</span> {
 <span style="color: #F0DFAF; font-weight: bold;">private</span> <span style="color: #7CB8BB;">String</span> <span style="color: #DFAF8F;">description</span>;
 <span style="color: #F0DFAF; font-weight: bold;">private</span> <span style="color: #7CB8BB;">String</span> <span style="color: #DFAF8F;">tag</span>;
 <span style="color: #F0DFAF; font-weight: bold;">private</span> <span style="color: #7CB8BB;">String</span> <span style="color: #DFAF8F;">imageUrl</span>;
 <span style="color: #F0DFAF; font-weight: bold;">private</span> <span style="color: #7CB8BB;">boolean</span> <span style="color: #DFAF8F;">favorite</span>;
 <span style="color: #5F7F5F;">//</span><span style="color: #7F9F7F;">getters and setters</span>
}
</pre>
</div></li>
<li><p>
配置Realm, 一般是创建一个RealmConfiguration对象, 将Realm文件存储到
App的"file"目录下. 
</p>
<div class="org-src-container">

<pre class="src src-java"><span style="color: #7CB8BB;">RealmConfiguration</span> <span style="color: #DFAF8F;">realmConfig</span> =
 <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #BFEBBF;">RealmConfiguration</span>.<span style="color: #7CB8BB;">Builder</span>(context).build();
Realm.setDefaultConfiguration(realmConfig);
<span style="color: #5F7F5F;">// </span><span style="color: #7F9F7F;">Get a Realm instance for this thread</span>
<span style="color: #7CB8BB;">Realm</span> <span style="color: #DFAF8F;">realm</span> = Realm.getDefaultInstance();
</pre>
</div></li>
<li><p>
持久化. Realm支持存储一个已存在的类实例, 或者通过传入class文件直接存储一个
新的类实例.
</p>
<div class="org-src-container">

<pre class="src src-java">realm.beginTransaction(); <span style="color: #5F7F5F;">// </span><span style="color: #7F9F7F;">Persist your data in a transaction</span>
<span style="color: #F0DFAF; font-weight: bold;">final</span> <span style="color: #7CB8BB;">Taco</span> <span style="color: #DFAF8F;">managedTaco</span> = realm.copyToRealm(unmanagedTaco); <span style="color: #5F7F5F;">// </span><span style="color: #7F9F7F;">Persist unmanaged objects</span>
<span style="color: #7CB8BB;">Taco</span> <span style="color: #DFAF8F;">taco</span> = realm.createObject(Taco.<span style="color: #F0DFAF; font-weight: bold;">class</span>); <span style="color: #5F7F5F;">// </span><span style="color: #7F9F7F;">Create managed objects directly</span>
realm.commitTransaction();
</pre>
</div></li>
<li><p>
获取数据.
</p>
<div class="org-src-container">

<pre class="src src-java"><span style="color: #7CB8BB;">Realm</span> <span style="color: #DFAF8F;">realm</span> = Realm.getDefaultInstance(); <span style="color: #5F7F5F;">// </span><span style="color: #7F9F7F;">Get a Realm instance for this thread</span>
<span style="color: #F0DFAF; font-weight: bold;">final</span> <span style="color: #7CB8BB;">RealmResults</span>&lt;<span style="color: #7CB8BB;">Taco</span>&gt; <span style="color: #DFAF8F;">likedTacos</span> =
realm.where(Taco.<span style="color: #F0DFAF; font-weight: bold;">class</span>).equalTo(<span style="color: #CC9393;">"favorite"</span>, <span style="color: #BFEBBF;">true</span>).findAll(); <span style="color: #5F7F5F;">//</span><span style="color: #7F9F7F;">find all favorite tacos</span>
</pre>
</div></li>
<li><p>
删除操作:
</p>
<div class="org-src-container">

<pre class="src src-java"><span style="color: #5F7F5F;">// </span><span style="color: #7F9F7F;">All changes to data must happen in a transaction</span>
realm.executeTransaction(<span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #BFEBBF;">Realm</span>.<span style="color: #7CB8BB;">Transaction</span>() {
 <span style="color: #BFEBBF;">@Override</span>
 <span style="color: #F0DFAF; font-weight: bold;">public</span> <span style="color: #7CB8BB;">void</span> <span style="color: #93E0E3;">execute</span>(<span style="color: #7CB8BB;">Realm</span> <span style="color: #DFAF8F;">realm</span>) {
 <span style="color: #5F7F5F;">// </span><span style="color: #7F9F7F;">remove single match</span>
 limeTacos.deleteFirstFromRealm();
 <span style="color: #5F7F5F;">//</span><span style="color: #7F9F7F;">or limeTacos.deleteLastFromRealm();</span>
 <span style="color: #5F7F5F;">// </span><span style="color: #7F9F7F;">remove a single object</span>
 <span style="color: #7CB8BB;">Taco</span> <span style="color: #DFAF8F;">fishTaco</span> = limeTacos.get(1);
 fishTaco.deleteFromRealm();
 <span style="color: #5F7F5F;">// </span><span style="color: #7F9F7F;">Delete all matches</span>
 limeTacos.deleteAllFromRealm();
 }
});
</pre>
</div></li>
</ol>
</div>
</div>
<div id="outline-container-orgheadline21" class="outline-3">
<h3 id="orgheadline21">一些特性</h3>
<div class="outline-text-3" id="text-orgheadline21">
<ol class="org-ol">
<li>Realm同样支持同步和异步的"写数据"操作, 通过调用不同的Api实现, 如下代码:
<ol class="org-ol">
<li><p>
同步写:
</p>
<div class="org-src-container">

<pre class="src src-java"><span style="color: #5F7F5F;">//</span><span style="color: #7F9F7F;">Transaction block</span>
realm.executeTransaction(<span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #BFEBBF;">Realm</span>.<span style="color: #7CB8BB;">Transaction</span>() {
 <span style="color: #BFEBBF;">@Override</span>
 <span style="color: #F0DFAF; font-weight: bold;">public</span> <span style="color: #7CB8BB;">void</span> <span style="color: #93E0E3;">execute</span>(<span style="color: #7CB8BB;">Realm</span> <span style="color: #DFAF8F;">realm</span>) {
    <span style="color: #7CB8BB;">Taco</span> <span style="color: #DFAF8F;">taco</span> = realm.createObject(Taco.<span style="color: #F0DFAF; font-weight: bold;">class</span>);
    taco.setDescription(<span style="color: #CC9393;">"Spaghetti Squash on Fresh Corn Tortillas"</span>);
    user.setImageUrl(<span style="color: #CC9393;">"http://tacoimages.com/1.jpg"</span>);
 }
});
</pre>
</div></li>
<li><p>
异步写, 需要传入两个个回调类对象参数, 分别是成功和失败的回调.
</p>
<div class="org-src-container">

<pre class="src src-java">realm.executeTransactionAsync(<span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #BFEBBF;">Realm</span>.<span style="color: #7CB8BB;">Transaction</span>() {
  <span style="color: #BFEBBF;">@Override</span>
  <span style="color: #F0DFAF; font-weight: bold;">public</span> <span style="color: #7CB8BB;">void</span> <span style="color: #93E0E3;">execute</span>(<span style="color: #7CB8BB;">Realm</span> <span style="color: #DFAF8F;">bgRealm</span>) {
     <span style="color: #7CB8BB;">Taco</span> <span style="color: #DFAF8F;">taco</span> = bgRealm.createObject(Taco.<span style="color: #F0DFAF; font-weight: bold;">class</span>);
     taco.setDescription(<span style="color: #CC9393;">"Spaghetti Squash on Fresh Corn Tortillas"</span>);
     user.setImageUrl(<span style="color: #CC9393;">"http://tacoimages.com/1.jpg"</span>);
  }}, <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #BFEBBF;">Realm</span>.<span style="color: #BFEBBF;">Transaction</span>.<span style="color: #7CB8BB;">OnSuccess</span>() {
         <span style="color: #BFEBBF;">@Override</span>
         <span style="color: #F0DFAF; font-weight: bold;">public</span> <span style="color: #7CB8BB;">void</span> <span style="color: #93E0E3;">onSuccess</span>() {}}, 
      <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #BFEBBF;">Realm</span>.<span style="color: #BFEBBF;">Transaction</span>.<span style="color: #7CB8BB;">OnError</span>() {
         <span style="color: #BFEBBF;">@Override</span>
         <span style="color: #F0DFAF; font-weight: bold;">public</span> <span style="color: #7CB8BB;">void</span> <span style="color: #93E0E3;">onError</span>(<span style="color: #7CB8BB;">Throwable</span> <span style="color: #DFAF8F;">error</span>) {}
 });
</pre>
</div></li>
</ol></li>
<li><p>
跟Gson一样, Realm也支持类成员变量的解析. 例如:
</p>
<div class="org-src-container">

<pre class="src src-java"><span style="color: #F0DFAF; font-weight: bold;">public</span> <span style="color: #F0DFAF; font-weight: bold;">class</span> <span style="color: #7CB8BB;">Taco</span> <span style="color: #F0DFAF; font-weight: bold;">extends</span> <span style="color: #7CB8BB;">RealmObject</span> {
 ...
 <span style="color: #F0DFAF; font-weight: bold;">private</span> <span style="color: #BFEBBF;">List</span>&lt;<span style="color: #7CB8BB;">Ingredient</span>&gt;
 ...
}
<span style="color: #F0DFAF; font-weight: bold;">public</span> <span style="color: #F0DFAF; font-weight: bold;">class</span> <span style="color: #7CB8BB;">Ingredient</span> <span style="color: #F0DFAF; font-weight: bold;">extends</span> <span style="color: #7CB8BB;">RealmObject</span> {
 <span style="color: #F0DFAF; font-weight: bold;">private</span> <span style="color: #7CB8BB;">String</span> <span style="color: #DFAF8F;">name</span>;
 <span style="color: #F0DFAF; font-weight: bold;">private</span> <span style="color: #7CB8BB;">URL</span> <span style="color: #DFAF8F;">url</span>;
}

<span style="color: #7CB8BB;">RealmResults</span>&lt;<span style="color: #7CB8BB;">Taco</span>&gt; <span style="color: #DFAF8F;">limeTacos</span> = realm.where(Taco.<span style="color: #F0DFAF; font-weight: bold;">class</span>)
 .equalTo(<span style="color: #CC9393;">"ingredients.name"</span>, <span style="color: #CC9393;">"Lime"</span>)
 .findAll();
</pre>
</div></li>
<li><p>
为RealmObject和RealmResults增加数据变化的listener.
</p>
<div class="org-src-container">

<pre class="src src-java">limeTacos.addChangeListener(
 <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">RealmChangeListener</span>&lt;<span style="color: #7CB8BB;">RealmResults</span>&lt;<span style="color: #7CB8BB;">Taco</span>&gt;&gt;() {
 <span style="color: #BFEBBF;">@Override</span>
 <span style="color: #F0DFAF; font-weight: bold;">public</span> <span style="color: #7CB8BB;">void</span> <span style="color: #93E0E3;">onChange</span>(<span style="color: #7CB8BB;">RealmResults</span>&lt;<span style="color: #7CB8BB;">Taco</span>&gt; <span style="color: #DFAF8F;">tacosConLimon</span>) {
 <span style="color: #5F7F5F;">//</span><span style="color: #7F9F7F;">tacosConLimon.size() == limeTacos.size()</span>
 <span style="color: #5F7F5F;">// </span><span style="color: #7F9F7F;">Query results are updated in real time</span>
     Log.d(<span style="color: #CC9393;">"LimeTacos"</span>, <span style="color: #CC9393;">"Now we have"</span> + limeTacos.size() + <span style="color: #CC9393;">" tacos"</span>);
 }
});
</pre>
</div></li>
<li><p>
为防止内存泄漏, 需要在onDestroy中关闭Realm.
</p>
<div class="org-src-container">

<pre class="src src-java"><span style="color: #BFEBBF;">@Override</span>
<span style="color: #F0DFAF; font-weight: bold;">protected</span> <span style="color: #7CB8BB;">void</span> <span style="color: #93E0E3;">onDestroy</span>() {
 realm.removeChangeListener(realmListener); <span style="color: #5F7F5F;">// </span><span style="color: #7F9F7F;">Remove the listener.</span>
 realm.close(); <span style="color: #5F7F5F;">//</span><span style="color: #7F9F7F;">or realm.removeAllChangeListeners(); Close the Realm instance.</span>
}
</pre>
</div></li>
</ol>
</div>
</div>
</div>
<div id="outline-container-orgheadline22" class="outline-2">
<h2 id="orgheadline22">番外篇: 简便启动activity - Dart + Henson</h2>
<div class="outline-text-2" id="text-orgheadline22">
<p>
  这两个类是受到ButterKnife启发实现的, 提供了一个更简便的启动Activity的方法, 
作者说, 不要再浪费时间写这样的代码啦.
</p>
<div class="org-src-container">

<pre class="src src-java">intent.putExtra(EXTRA_TACO_DESCRIPTION, <span style="color: #CC9393;">"Seasoned Lentils with Green Chile on Naan"</span>);
tacoDescription = getIntent().getExtras().getString(EXTRA_TACO_DESCRIPTION);
</pre>
</div>
</div>
<div id="outline-container-orgheadline23" class="outline-3">
<h3 id="orgheadline23">基本用法</h3>
<div class="outline-text-3" id="text-orgheadline23">
<ol class="org-ol">
<li><p>
Dart定义intent使用到的参数.
</p>
<div class="org-src-container">

<pre class="src src-java"><span style="color: #F0DFAF; font-weight: bold;">public</span> <span style="color: #F0DFAF; font-weight: bold;">class</span> <span style="color: #7CB8BB;">TacoDetailActivity</span> <span style="color: #F0DFAF; font-weight: bold;">extends</span> <span style="color: #7CB8BB;">Activity</span> {
 <span style="color: #5F7F5F;">//</span><span style="color: #7F9F7F;">Required. Exception thrown if missing</span>
 <span style="color: #BFEBBF;">@InjectExtra</span> <span style="color: #7CB8BB;">boolean</span> <span style="color: #DFAF8F;">favorite</span>;
 <span style="color: #BFEBBF;">@InjectExtra</span> String description
 <span style="color: #5F7F5F;">//</span><span style="color: #7F9F7F;">default value if left null</span>
 <span style="color: #BFEBBF;">@Nullable</span> <span style="color: #BFEBBF;">@InjectExtra</span> <span style="color: #7CB8BB;">String</span> <span style="color: #DFAF8F;">tag</span> = <span style="color: #CC9393;">"taco"</span>;
 <span style="color: #5F7F5F;">//</span><span style="color: #7F9F7F;">Ingredient implements Parcelable</span>
 <span style="color: #BFEBBF;">@Nullable</span> <span style="color: #BFEBBF;">@InjectExtra</span> <span style="color: #7CB8BB;">Ingredient</span> <span style="color: #DFAF8F;">withIngredient</span>;
 <span style="color: #BFEBBF;">@Override</span>
 <span style="color: #F0DFAF; font-weight: bold;">public</span> <span style="color: #7CB8BB;">void</span> <span style="color: #93E0E3;">onCreate</span>(<span style="color: #7CB8BB;">Bundle</span> <span style="color: #DFAF8F;">bundle</span>) {
 <span style="color: #F0DFAF; font-weight: bold;">super</span>.onCreate(bundle);
 Dart.inject(<span style="color: #F0DFAF; font-weight: bold;">this</span>);
 <span style="color: #5F7F5F;">//</span><span style="color: #7F9F7F;">TODO use member variables</span>
 ...
 }
}
</pre>
</div></li>
<li><p>
使用Henson生成intent. 
</p>
<div class="org-src-container">

<pre class="src src-java"><span style="color: #5F7F5F;">//</span><span style="color: #7F9F7F;">Start intent for TacoDetailActivity</span>
<span style="color: #7CB8BB;">Intent</span> <span style="color: #DFAF8F;">intent</span> = Henson.with(context)
 .gotoTacoDetailActivity()
 .favorite(<span style="color: #BFEBBF;">true</span>)
 .description(<span style="color: #CC9393;">"Seasoned Lentils with Green Chile on Naan"</span>)
 .ingredient(<span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">Ingredient</span>())
 .build();
<span style="color: #5F7F5F;">// </span><span style="color: #7F9F7F;">tag is null or defaults to "taco"</span>
startActivity(intent);
</pre>
</div></li>
</ol>
</div>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="postamble">Created At <span class="timestamp-wrapper"><span class="timestamp">&lt;2016-08-14 Sun 23:25&gt;</span></span> by Luis Xu. Email: <a href="mailto:xuzhengchaojob@gmail.com">xuzhengchaojob@gmail.com</a></p>
</div>
</body>
</html>
