<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2016-08-16 Tue 14:31 -->
<meta  http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta  name="viewport" content="width=device-width, initial-scale=1" />
<title></title>
<meta  name="generator" content="Org-mode" />
<meta  name="author" content="Zhengchao Xu" />
<link rel="stylesheet" title="Standard" href="/style/worg.css" type="text/css" />
<link rel="alternate stylesheet" title="Zenburn" href="/style/worg-zenburn.css" type="text/css" />
<link rel="alternate stylesheet" title="Classic" href="/style/worg-classic.css" type="text/css" />
<link rel="SHORTCUT ICON" href="/org-mode-unicorn.ico" type="image/x-icon" />
<link rel="icon" href="/org-mode-unicorn.ico" type="image/ico" />
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2013 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
</head>
<body>
<div id="preamble" class="status">
<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-7691209-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

  document.addEventListener('DOMContentLoaded',function() {
      document.getElementById("table-of-contents").onclick = function() {
          var elem = document.getElementById("text-table-of-contents");
          elem.style.display = elem.style.display == "block" ? "none" : "block";
      }
  });
</script>
</div>
<div id="content">
---
layout: post
title: Orgmode手册2:表格
categories: [OrgMode]
tag: [orgmode, translate]
---

<p>
Org mode提供了强大到"令人发指"的表格处理功能, 与excel不同, 
纯文本下编辑表格是另外一种美好的体验.
</p>

<div id="outline-container-orgheadline1" class="outline-2">
<h2 id="orgheadline1">创建表格</h2>
<div class="outline-text-2" id="text-orgheadline1">
<p>
在org中任何以"|"字符开头的内容都会认为是
表格的一部分. 在表格当前行按TAB或C-c C-c会格式化表格.
按RET键会自动创建 下一行. 
同时任何以"|-"开头的行都被认为是表格分隔符.
</p>

<p>
快捷键 <b>C-c |</b> 可以创建表格或将选中区域转化为表格, 会询问你创建的表格大小.
如果要转化的区域都含有TAB字符, 会将TAB作为分隔符. 如果为逗号, 会认为是逗号.
否则为空白字符.可以通过前缀强制选择"分隔符":
</p>
<ul class="org-ul">
<li>C-u 强制认为是CSV格式(逗号分割), 对于经常处理csv格式的人很有用.</li>
<li>C-u C-u 强制TAB</li>
</ul>

<p>
下表是另外一些操作表格的快捷键. 
</p>
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">快捷键</th>
<th scope="col" class="org-left">功能</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">C-c C-c</td>
<td class="org-left">对齐表格</td>
</tr>

<tr>
<td class="org-left">TAB</td>
<td class="org-left">对齐表格, 移到下一格</td>
</tr>

<tr>
<td class="org-left">S-TAB</td>
<td class="org-left">对齐表格, 移到上一格</td>
</tr>

<tr>
<td class="org-left">RET</td>
<td class="org-left">对齐表格, 移到下一行</td>
</tr>

<tr>
<td class="org-left">M-a/e</td>
<td class="org-left">移到这一格开始/结尾</td>
</tr>

<tr>
<td class="org-left">M-left/right/up/down</td>
<td class="org-left">左/右/上/下移动该行</td>
</tr>

<tr>
<td class="org-left">M-S-left/up/</td>
<td class="org-left">删除当前列/行</td>
</tr>

<tr>
<td class="org-left">M-S-right/down</td>
<td class="org-left">添加新列/行</td>
</tr>

<tr>
<td class="org-left">C-c -/C-c RET</td>
<td class="org-left">添加新分割行</td>
</tr>

<tr>
<td class="org-left">C-c ^</td>
<td class="org-left">排序</td>
</tr>

<tr>
<td class="org-left">C-c C-x M-w/C-w/C-y</td>
<td class="org-left">粘贴/剪切/复制当前区域</td>
</tr>

<tr>
<td class="org-left">C-c +</td>
<td class="org-left">计算当前列的和</td>
</tr>

<tr>
<td class="org-left">S-RET</td>
<td class="org-left">复制</td>
</tr>

<tr>
<td class="org-left">C-c `</td>
<td class="org-left">新窗口编辑当前区域.</td>
</tr>

<tr>
<td class="org-left">M-x org-table-import</td>
<td class="org-left">导入文件作为表格</td>
</tr>

<tr>
<td class="org-left">C-c</td>
<td class="org-left">将选中区域表示为表格</td>
</tr>

<tr>
<td class="org-left">M-x org-table-export</td>
<td class="org-left">到处表格</td>
</tr>
</tbody>
</table>
</div>
</div>

<div id="outline-container-orgheadline4" class="outline-2">
<h2 id="orgheadline4">表格宽度和对齐</h2>
<div class="outline-text-2" id="text-orgheadline4">
</div><div id="outline-container-orgheadline2" class="outline-3">
<h3 id="orgheadline2">设置列宽度</h3>
<div class="outline-text-3" id="text-orgheadline2">
<p>
如果某一列的内容太长, 看上去会比较不美观, 可以通过设置列的宽度来隐藏
一部分内容. 
</p>

<p>
要设置列宽度, 在这一列的任何的一个空白单元格(没有的话可以创建一个空白行)内
加入 <b>&lt;N&gt;</b>, N就是你要设置的宽度.然后按"C-c C-c"即可改变宽度. 
如果该列某一行的宽度大于N, 那么该区域内容会被"压缩", 如果还想查看完整内容, 把
鼠标放到上面即可, 如果要编辑该内容, 在该表格框内按 <b>C-c `</b>. 
下图是一个示例:
</p>


<div class="figure">
<p><img src="../../../../public/img/org-table2.jpg" alt="org-table2.jpg" />
</p>
</div>

<p>
当第一次打开文件时, 即使该文件的表格设置了"压缩", 也会看到"压缩"并未发生, 超过宽度的内容
仍然会在表格中显示, 如果想要打开即显示压缩, 可以在文档中加入 <b>#+STARTUP:align</b> 来打开这个功能. 
</p>
</div>
</div>
<div id="outline-container-orgheadline3" class="outline-3">
<h3 id="orgheadline3">设置左右对齐</h3>
<div class="outline-text-3" id="text-orgheadline3">
<p>
跟设置宽度一样, 在某一空白区域添加 &lt;r&gt; 或 &lt;l&gt;. 宽度和对齐也可以结合使用:&lt;r10&gt;.
</p>
</div>
</div>
</div>
<div id="outline-container-orgheadline5" class="outline-2">
<h2 id="orgheadline5">引用表中数据</h2>
<div class="outline-text-2" id="text-orgheadline5">
<p>
如果要在公式或其他地方使用表格中的数据, 必须要有一种方法可以表示表格中的
一个或一块区域. Org中区域可以通过名称/坐标/相对地址等方式引用. 可以在
单元格上面使用快捷键"C-c ?"来查看该单元格的坐标. 或使用 "C-c }"来显示一块区域.
</p>
<ol class="org-ol">
<li><p>
引用表格的几种方法
</p>
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">格式</th>
<th scope="col" class="org-left">含义</th>
<th scope="col" class="org-left">补充</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">letter/number</td>
<td class="org-left">某一格</td>
<td class="org-left">B3表示第三行第二列</td>
</tr>

<tr>
<td class="org-left">@N</td>
<td class="org-left">某一行</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">$N</td>
<td class="org-left">某一列</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">@M$N</td>
<td class="org-left">某一格</td>
<td class="org-left">@3$2 第三行第二列</td>
</tr>

<tr>
<td class="org-left">$+/-N</td>
<td class="org-left">当前列的相对列</td>
<td class="org-left">同样适用于行</td>
</tr>

<tr>
<td class="org-left">$&lt; $&gt;</td>
<td class="org-left">第一列和最后一列</td>
<td class="org-left">$&lt;&lt;&lt;倒数第三列, 适用于行</td>
</tr>

<tr>
<td class="org-left">@I</td>
<td class="org-left">high line</td>
<td class="org-left">例如本例第二行</td>
</tr>

<tr>
<td class="org-left">@0 $0</td>
<td class="org-left">当前行/列</td>
<td class="org-left">&#xa0;</td>
</tr>
</tbody>
</table></li>
<li>使用".."来表示一个区域, 例如 $1..$3表示第一列到第三列</li>
<li>使用 @# $# 来表示当前行/列的值.</li>
<li>命名. org table支持命名方式, 可以通过 "org-table-formula-constants"来设置一个
全局的名字, 或通过 "#+CONSTANTS"单独为一个文件设置名称变量. 也可以在表格中
使用emacs的properties功能来使用property变量.</li>
<li>远程引用. 可以通过远程引用的方式引用其他文件或该文件其他表格的内容.
远程引用的语法为: remote(NAME-OR-ID, REF). 第一个参数可以是本文件中
用 #+NAME 来命名的表格, 或其他文件中的一个entry ID. REF是当前表格的一个区域.</li>
</ol>
</div>
</div>
<div id="outline-container-orgheadline6" class="outline-2">
<h2 id="orgheadline6">表格处理计算</h2>
<div class="outline-text-2" id="text-orgheadline6">
<p>
文章开始说过, org mode提供了各种表格计算功能, 下面就看一下具体的操作,
</p>

<p>
表格计算可以在表格底部用"#+TBLFM:"关键字, 后面接计算公式, 目前
表格支持 "Calc" 和 lisp计算公式. 如下图表格, 公式
"#+TBLFM: $5=$1+$2+$3+$4" 用于计算前四列的和, 并将结果写入第五列.
</p>


<div class="figure">
<p><img src="../../../../public/img/org-table.png" alt="org-table.png" />
</p>
</div>

<p>
注: Calc中"/"的优先级低于"*". 所以公式 <b>$4=$1/$2*$3</b> 实际为 
<b>$4=$1/($2*$3)</b>.
</p>
</div>
<div id="outline-container-orgheadline7" class="outline-3">
<h3 id="orgheadline7">附加模式.</h3>
<div class="outline-text-3" id="text-orgheadline7">
<p>
附件模式可以用于计算特定格式的内容, 或者格式化数据.
org支持公式后面添加任意数量的附加模式, 公式和
附加模式之间用";"隔开. 目前支持的附加模式包括:
</p>
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">表示</th>
<th scope="col" class="org-left">意义</th>
<th scope="col" class="org-left">&#xa0;</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">pN</td>
<td class="org-left">计算精度</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">nN,sN,eN,fN</td>
<td class="org-left">普通/科学/工程/固定表示</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">D/R</td>
<td class="org-left">度/弧度模式</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">F/S</td>
<td class="org-left">小数模式</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">T/t</td>
<td class="org-left">时间计算模式</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">E</td>
<td class="org-left">控制怎样表示空白格</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">N</td>
<td class="org-left">把所有表格表示为数字, 非数字0代替</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">L</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
</tr>
</tbody>
</table>

<p>
下面是一些实例程序
</p>
<pre class="example">
$1+$2                Sum of first and second field
$1+$2;%.2f           保留小数点两位
exp($2)+exp($1)      数学公式
tan($1);Dp3s1        计算度数, 精度为3, 展示为科学计数
</pre>
</div>
</div>
<div id="outline-container-orgheadline8" class="outline-3">
<h3 id="orgheadline8">lisp代码处理表格.</h3>
<div class="outline-text-3" id="text-orgheadline8">
<p>
org支持用lisp代码处理表格. 以 '( 开头的表达式会被解析为lisp代码,
默认情况下, 表格的内容会被引用为字符串, 如果需要将其处理为数字,
需要将其转化为N模式(后面加";N"). 也可以用使用双引号将其表示为字符串.
"范围(..)"会被解析为空格分开的域. 例如前面表格相加的公司用lisp表示为
<b>$5='(+ $1 $2 $3 $4)</b>. 下面是一些例子:
</p>
<pre class="example">
'(concat (substring $1 1 2) (substring $1 0 1) (substring $1 2))
   交互第一列表格内容的前两个字符
'(+ $1 $2);N   Add columns 1 and 2, equivalent to Calc's `$1+$2'.
'(apply '+ '($1..$4));N   另外一种表格相加方法
</pre>
</div>
</div>
<div id="outline-container-orgheadline9" class="outline-3">
<h3 id="orgheadline9">时间计算.</h3>
<div class="outline-text-3" id="text-orgheadline9">
<p>
前面讲过表格支持时间计算.表格支持的时间格式为 HH:MM[:SS], 
其中SS是可选, 如果公式后面接";T", 计算结果会展示为 HH:MM:SS.
如果为";t", 计算结果为小时的小数表示. 下面的例子展示了这一点:
</p>
<pre class="example">
|  Task 1 |   Task 2 |    Total |
|---------+----------+----------|
|    2:12 |     1:47 | 03:59:00 |
| 3:02:20 | -2:07:00 |     0.92 |
#+TBLFM: @2$3=$1+$2;T::@3$3=$1+$2;t
</pre>
</div>
</div>
<div id="outline-container-orgheadline10" class="outline-3">
<h3 id="orgheadline10">直接在某一格中输入公式.</h3>
<div class="outline-text-3" id="text-orgheadline10">
<p>
可以直接在域中输入公式. 在域中输入":="并后面接公式. 也可以
在当前域中输入 "C-u C-c ="命令在提示框中输入公式.
</p>
</div>
</div>
<div id="outline-container-orgheadline11" class="outline-3">
<h3 id="orgheadline11">查找功能</h3>
<div class="outline-text-3" id="text-orgheadline11">
<p>
orgmode提供了三个查找函数用于在表中进行查找:
</p>
<ul class="org-ul">
<li>(org-lookup-first VAL S-LIST R-LIST &amp;optional PREDICATE)
在S-LIST中查找第一个 (PREDICATE VAL S)值为t的S. 并返回R-LIST与S位置相同的
值. PREDICATE的默认值为 equal, 如果R-LIST为nil, 则返回S.</li>
<li>(org-lookup-first VAL S-LIST R-LIST &amp;optional PREDICATE)
与上一个函数意义相同, 不过是先查找最后一个.</li>
<li>(org-lookup-first VAL S-LIST R-LIST &amp;optional PREDICATE)
相似函数. 不过返回的是一个列表.</li>
</ul>

<p>
下面是一个示例, 更多示例看这篇文章: <a href="http://orgmode.org/worg/org-tutorials/org-lookups.html">http://orgmode.org/worg/org-tutorials/org-lookups.html</a>
</p>
<pre class="example">
 #+TBLNAME: rates
| currency        | abbreviation | euros |
|-----------------+--------------+-------|
| euro            | eur          |     1 |
| Norwegian krone | nok          |  0.14 |
| Swedish krona   | sek          |  0.12 |
| US dollar       | usd          |  0.77 |

#+TBLNAME: cost
|  date | expense          |  sum | currency |   rate |  euros |   |
|-------+------------------+------+----------+--------+--------+---|
|  1.3. | flights          |  324 | eur      |      1 |    324 |   |
|  4.6. | books and maps   |  243 | usd      |   0.77 | 187.11 |   |
| 30.7. | rental car       | 8300 | sek      |   0.12 |   996. |   |
|  2.7. | hotel            | 1150 | sek      |   0.12 |   138. |   |
|  2.7. | lunch            |  190 | sek      |   0.12 |   22.8 |   |
|  3.7. | fishing licenses | 1400 | nok      |   0.14 |   196. |   |
|  3.7. | gasoline         |  340 |          | #ERROR | #ERROR |   |
 #+TBLFM: $5='(org-lookup-first $4 '(remote(rates,@2$2..@&gt;$2)) '(remote(rates,@2$3..@&gt;$3)))::$6=$5*$3
函数解释第一个函数查找cost表的第四列和rates表的第二列相同的值, 并将查找结果对应的
rates表的第三列填充到cost表的第五列, 然后计算第六列的值.
</pre>
</div>
</div>
<div id="outline-container-orgheadline12" class="outline-3">
<h3 id="orgheadline12">调试公式</h3>
<div class="outline-text-3" id="text-orgheadline12">
<p>
org mode提供了下列用于调试公式的快捷键:
</p>
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">快捷键</th>
<th scope="col" class="org-left">功能</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">C-c = / C-u C-c =</td>
<td class="org-left">在当前格写入公式</td>
</tr>

<tr>
<td class="org-left">C-u C-u C-c =</td>
<td class="org-left">重新插入公式</td>
</tr>

<tr>
<td class="org-left">C-c ?</td>
<td class="org-left">当前格信息</td>
</tr>

<tr>
<td class="org-left">C-c }</td>
<td class="org-left">表信息</td>
</tr>

<tr>
<td class="org-left">C-c {</td>
<td class="org-left">打开/关闭调试</td>
</tr>

<tr>
<td class="org-left">C-c '</td>
<td class="org-left">在buffer中编辑所有公式</td>
</tr>

<tr>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div id="outline-container-orgheadline15" class="outline-2">
<h2 id="orgheadline15">其他特性</h2>
<div class="outline-text-2" id="text-orgheadline15">
</div><div id="outline-container-orgheadline13" class="outline-3">
<h3 id="orgheadline13">列组</h3>
<div class="outline-text-3" id="text-orgheadline13">
<p>
Org导出表格时, 默认是以行为单位, 也可以按列为单位来处理数据.
这需要添加一个特殊行: 该行的第一个区域只包含"/", 其他以"&lt;"表示的区域
表示是一个组的开始, 以"&gt;"结束表示组的结束.
</p>
</div>
</div>
<div id="outline-container-orgheadline14" class="outline-3">
<h3 id="orgheadline14">Orgtbl 模式</h3>
<div class="outline-text-3" id="text-orgheadline14">
<p>
如果想在其他的mode下使用org mode的table功能, 可以输入命令 "orgtbl-mode".
</p>
</div>
</div>
</div>
</div>
<div id="postamble" class="status">
<div id="show_source"><input type="button" value="Show Org source" onClick='show_org_source()'></div><div id="license"><p>Documentation from the http://orgmode.org/worg/ website (either in its HTML format or in its Org format) is licensed under the <a href="http://www.gnu.org/copyleft/fdl.html">GNU Free Documentation License version 1.3</a> or later.  The code examples and css stylesheets are licensed under the <a href="http://www.gnu.org/licenses/gpl.html">GNU General Public License v3</a> or later.</p></div>
</div>
</body>
</html>
