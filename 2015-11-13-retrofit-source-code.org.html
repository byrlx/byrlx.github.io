<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN">
<!-- Created by htmlize-1.43 in css mode. -->
<html>
  <head>
    <title>2015-11-13-retrofit-source-code.org</title>
    <style type="text/css">
    <!--
      body {
        color: #DCDCCC;
        background-color: #3F3F3F;
      }
      .bold {
        /* bold */
        font-weight: bold;
      }
      .org-block {
        /* org-block */
        color: #009acd;
      }
      .org-block-begin-line {
        /* org-block-begin-line */
        color: #7F9F7F;
      }
      .org-block-end-line {
        /* org-block-end-line */
        color: #7F9F7F;
      }
      .org-code {
        /* org-code */
        color: #b3b3b3;
      }
      .org-document-info {
        /* org-document-info */
        color: #afeeee;
      }
      .org-document-info-keyword {
        /* org-document-info-keyword */
        color: #b3b3b3;
      }
      .org-level-1 {
        /* org-level-1 */
        color: #DFAF8F;
        font-size: 130%;
        text-decoration: overline;
      }
      .org-level-2 {
        /* org-level-2 */
        color: #BFEBBF;
        font-size: 120%;
      }
      .org-link {
        /* org-link */
        color: #D0BF8F;
        text-decoration: underline;
      }
      .org-meta-line {
        /* org-meta-line */
        color: #7F9F7F;
      }
      .org-table {
        /* org-table */
        color: #9FC59F;
      }

      a {
        color: inherit;
        background-color: inherit;
        font: inherit;
        text-decoration: inherit;
      }
      a:hover {
        text-decoration: underline;
      }
    -->
    </style>
  </head>
  <body>
    <pre>
<span class="org-meta-line">#+OPTIONS: ^:nil</span>
<span class="org-meta-line">#+OPTIONS: H:nil</span>
<span class="org-meta-line">#+OPTIONS: toc:t H:2</span>
<span class="org-document-info-keyword">#+AUTHOR:</span> <span class="org-document-info">Zhengchao Xu
</span><span class="org-document-info-keyword">#+EMAIL:</span> <span class="org-document-info">xuzhengchaojob@gmail.com
</span>
<span class="org-block-begin-line">#+BEGIN_HTML
</span><span class="org-block">---
layout: post
title: 'Retrofit&#28304;&#30721;1: &#20026;&#20160;&#20040;&#20889;&#19968;&#20010;interface&#23601;&#21487;&#20197;&#23454;&#29616;http&#35831;&#27714;'
tag: [java, android, square]
description: [retrofit&#28304;&#30721;&#38405;&#35835;&#31508;&#35760;]
categories: [Java]
---
</span><span class="org-block-end-line">#+END_HTML
</span>
&#26412;&#25991;&#23398;&#20064;&#30340;retrofit&#28304;&#30721;&#29256;&#26412;&#21495;: parent-2.0.0.

<span class="org-level-1">* &#20195;&#30721;&#31034;&#20363;</span>
  &#19981;&#20102;&#35299;Retrofit&#30340;&#20154;&#21487;&#20197;&#20808;&#21442;&#32771;&#36825;&#31687;&#20171;&#32461;&#25991;&#31456;<span class="org-link"><a href="http://xuzhengchao.com/java/retrofit.html">Retrofit&#20171;&#32461;</a></span>, &#25991;&#31456;&#20171;&#32461;&#20102;
  &#22914;&#20309;&#36890;&#36807;&#20889;&#19968;&#20010;&#31616;&#21333;&#30340;&#25509;&#21475;, &#23601;&#21487;&#20197;&#23454;&#29616;&#19968;&#20010;http&#35831;&#27714;. 

  &#26412;&#25991;&#20027;&#35201;&#30340;&#20869;&#23481;&#23601;&#26159;&#20171;&#32461;retrofit&#26159;&#22914;&#20309;&#23454;&#29616;&#30340;&#36825;&#20010;&#21151;&#33021;, &#21363;&#21482;&#23454;&#29616;&#19968;&#20010;&#25509;&#21475;
  &#21450;&#19968;&#20123;&#25509;&#21475;api(&#36825;&#20123;api&#37117;&#34987;retrofit&#30340;&#27880;&#35299;"&#20462;&#39280;"), &#27809;&#26377;&#23454;&#29616;&#20219;&#20309;&#20855;&#20307;&#20195;&#30721;,
  &#23601;&#21487;&#20197;&#23436;&#25104;&#25105;&#20204;&#24819;&#35201;&#30340;http&#21151;&#33021;, retrofit&#21040;&#24213;&#22312;&#21518;&#38754;&#20570;&#20102;&#20160;&#20040;?

  &#19979;&#38754;&#30340;&#31034;&#20363;&#20195;&#30721;&#26159;&#25581;&#24320;retrofit&#38754;&#32433;&#30340;&#20837;&#21475;&#20195;&#30721;, &#36890;&#36807;&#35813;&#20195;&#30721;&#21487;&#20197;&#20174;&#26381;&#21153;&#22120;&#33719;&#21462;&#29992;&#25143;&#21015;&#34920;
<span class="org-block-begin-line">  #+BEGIN_EXAMPLE
</span><span class="org-block">//&#33258;&#23450;&#20041;&#25509;&#21475;
public interface Client {
    @GET("users")
    Call&lt;List&lt;User&gt;&gt;  getUsers();
}

//&#20351;&#29992;retrofit&#26469;&#20351;&#29992;&#33258;&#24049;&#23450;&#20041;&#25509;&#21475;&#23454;&#29616;http&#35831;&#27714;
public class MainActivity {
    ....
    public static final String SERVER_URL = "<a href="http://10.10.10.10/account">http://10.10.10.10/account</a>";
    private OkHttpClient okHttpClient = new OkHttpClient();
    private Retrofit.Builder builder = new Retrofit.Builder()
        .base_url(SERVER_URL)
        .client(okHttpClient)
        .addConvertFactory(GsonConvertFactory.create());

    Retrofit retrofit = builder.build();
    Client client = retrofit.create(Client.class);
    Call&lt;List&lt;Users&gt;&gt; call = client.getUsers();
    List&lt;Users&gt; result = call.execute().body();
    ....
}

</span><span class="org-block-end-line">  #+END_EXAMPLE
</span> 
<span class="org-level-1">* &#20351;&#29992;builder&#21435;&#21019;&#24314;&#19968;&#20010;retrofit&#23454;&#20363;</span>
  Retrofit&#31867;&#30340;&#28304;&#30721;&#20351;&#29992;&#20102;Builder&#35774;&#35745;&#27169;&#24335;, &#35813;&#31867;&#21482;&#26377;&#19968;&#20010;&#31169;&#26377;&#30340;&#26500;&#36896;&#20989;&#25968;, &#24182;&#19988;"&#20960;&#20046;"&#27809;&#26377;
  &#20219;&#20309;&#30340;setter&#26041;&#27861;, &#36825;&#26679;&#21487;&#20197;&#26368;&#22823;&#31243;&#24207;&#30340;&#20445;&#35777;retrofit&#23545;&#35937;&#30340;"&#19981;&#21487;&#21464;&#24615;".

  &#19979;&#38754;&#26159;&#36890;&#36807;builder&#31867;&#21487;&#20197;&#35774;&#32622;&#30340;Retrofit&#25104;&#21592;&#21464;&#37327;:
  <span class="org-table">| &#21464;&#37327;&#21517;             | &#40664;&#35748;&#20540;                     | note                                                           |</span>
  <span class="org-table">|--------------------+----------------------------+----------------------------------------------------------------|</span>
  <span class="org-table">|                    |                            |                                                                |</span>
  <span class="org-table">| platform           | &#24403;&#21069;&#24179;&#21488;                   | &#24403;&#21069;&#36816;&#34892;&#24179;&#21488;:java/android/..                                   |</span>
  <span class="org-table">| callFactory        | OkHttpClient               | &#23450;&#20041;&#26500;&#24314;Call&#23545;&#35937;&#30340;&#32452;&#20214;                                         |</span>
  <span class="org-table">| baseUrl            | N/A                        | &#26381;&#21153;&#22120;&#22522;&#26412;&#22320;&#22336;                                                 |</span>
  <span class="org-table">| converterFactories | N/A                        | &#23545;&#35937;&#30340;&#24207;&#21015;&#21495;/&#21453;&#24207;&#21015;&#21270;&#32452;&#20214;(&#20363;&#22914;Gson)                            |</span>
  <span class="org-table">| adapterFactories   | &#35813;&#24179;&#21488;&#30340;&#40664;&#35748;adapterFactory | &#32467;&#26524;&#30340;&#36866;&#37197;&#31867;&#22411;(&#20363;&#22914;RxJava&#30340;Observable)(&#40664;&#35748;&#20026;OkHttp&#30340;Call&#31867;&#22411;) |</span>
  <span class="org-table">| callbackExecutor   | &#35813;&#24179;&#21488;&#30340;executor           | &#25191;&#34892;&#23454;&#38469;&#35831;&#27714;                                                   |</span>
    
<span class="org-level-1">* &#24403;&#21069;&#36816;&#34892;&#24179;&#21488;</span>
  &#22312;<span class="org-link"><a href="&#20351;&#29992;builder&#21435;&#21019;&#24314;&#19968;&#20010;retrofit&#23454;&#20363;">&#19978;&#19968;&#33410;</a></span>&#21487;&#20197;&#30475;&#21040;, builder&#30340;&#21442;&#25968;&#40664;&#35748;&#26159;&#20351;&#29992;&#20102;"platform"&#30456;&#20851;&#30340;&#21464;&#37327;. 
  "platform"&#22312;retrofit&#20013;&#20195;&#34920;&#24403;&#21069;&#30340;&#36816;&#34892;&#24179;&#21488;, &#20363;&#22914;Java8&#25110;&#32773;Android&#24179;&#21488;.
  &#20195;&#30721;&#20026;&#19982;Platform.java. Retrofit&#30340;builder&#31867;&#30340;&#26080;&#21442;&#26500;&#36896;&#20989;&#25968;&#20013;, &#20250;&#35843;&#29992;
  <span class="org-code">~Platform.get()~</span> &#33719;&#21462;&#24403;&#21069;&#24179;&#21488;, &#23545;&#20110;&#36816;&#34892;&#22312;&#37027;&#20010;&#24179;&#21488;&#30340;&#21028;&#26029;, &#20027;&#35201;&#26159;&#22522;&#20110;
  &#35813;&#24179;&#21488;&#30340;&#19968;&#20123;&#29420;&#29305;&#24615;&#36136;, &#20363;&#22914;&#22914;&#26524;&#31995;&#32479;&#23384;&#22312; <span class="bold">*android.os.Build*</span> &#31867;,
  &#21017;&#20195;&#34920;&#36825;&#26159;android&#24179;&#21488;.
<span class="org-block-begin-line">  #+BEGIN_EXAMPLE
</span><span class="org-block">  private static final Platform PLATFORM = findPlatform();

  static Platform get() {
    return PLATFORM;
  }

  private static Platform findPlatform() {
    try {
      Class.forName("android.os.Build");
      if (Build.VERSION.SDK_INT != 0) {
        return new Android();
      }
    } catch (ClassNotFoundException ignored) {
    }
    try {
      Class.forName("java.util.Optional");
      return new Java8();
    } catch (ClassNotFoundException ignored) {
    }
    try {
      Class.forName("org.robovm.apple.foundation.NSObject");
      return new IOS();
    } catch (ClassNotFoundException ignored) {
    }
    return new Platform();
  }
</span><span class="org-block-end-line">  #+END_EXAMPLE
</span>  &#19979;&#38754;&#26159;Android&#24179;&#21488;&#30340;&#23454;&#29616;&#20195;&#30721;,&#20854;&#37325;&#20889;&#20102;&#29238;&#31867;&#30340;&#20004;&#20010;&#20989;&#25968;. &#21478;&#22806;, &#35813;&#31867;&#36824;&#26377;&#20010;
  &#32487;&#25215;&#20102;Executor&#30340;&#23376;&#31867; <span class="bold">*MainThreadExecutor*</span>, &#35813;&#31867;&#21253;&#21547;&#20102;android&#30340; UI
  &#32447;&#31243;&#30340;handler, &#20174;&#32780;&#20445;&#35777;&#24037;&#20316;&#37117;&#20250;&#22312;UI&#32447;&#31243;&#23436;&#25104;. &#33267;&#20110;&#20854;&#37325;&#20889;&#30340;&#20989;&#25968;&#30340;&#24847;&#20041;, 
  &#20250;&#22312;&#21518;&#38754;&#20171;&#32461;.
<span class="org-block-begin-line">  #+BEGIN_EXAMPLE
</span><span class="org-block">  static class Android extends Platform {
    @Override public Executor defaultCallbackExecutor() {
      return new MainThreadExecutor();
    }

    @Override CallAdapter.Factory defaultCallAdapterFactory(Executor callbackExecutor) {
      return new ExecutorCallAdapterFactory(callbackExecutor);
    }

    static class MainThreadExecutor implements Executor {
      private final Handler handler = new Handler(Looper.getMainLooper());

      @Override public void execute(Runnable r) {
        handler.post(r);
      }
    }
  }
</span><span class="org-block-end-line">  #+END_EXAMPLE
</span><span class="org-level-1">* &#22522;&#20110;&#33258;&#23450;&#20041;interface&#21019;&#24314;&#23454;&#20363;</span>
  &#21069;&#20004;&#37096;&#20998;&#20027;&#35201;&#20171;&#32461;&#20102;&#19968;&#19979;retrofit&#30340;builder&#31867;, &#36890;&#36807;builder&#30340;build()&#20989;&#25968;&#23601;&#21487;&#20197;&#26500;&#36896;
  &#19968;&#20010;retrofit&#23454;&#20363;. &#25509;&#19979;&#26469;&#23601;&#26159;retrofit&#24456;&#31070;&#22855;&#30340;&#19968;&#27493;:&#36890;&#36807;create()&#20989;&#25968;&#21019;&#24314;&#19968;&#20010;&#33258;&#23450;&#20041;
  &#25509;&#21475;&#30340;&#23545;&#35937;&#23454;&#20363;:
<span class="org-block-begin-line">  #+BEGIN_EXAMPLE
</span><span class="org-block">  Client client = retrofit.create(Client.class);
</span><span class="org-block-end-line">  #+END_EXAMPLE
</span>
  &#22312;&#21069;&#38754;&#30340;&#31034;&#20363;&#20195;&#30721;&#20013;, Client&#26159;&#25105;&#20204;&#21019;&#24314;&#30340;&#19968;&#20010;&#25509;&#21475;, &#24182;&#27809;&#26377;&#20219;&#20309;&#30340;"&#23454;&#20307;"&#20195;&#30721;(&#23454;&#29616;&#31867;),
  &#20294;&#26159;&#36825;&#37324;&#36890;&#36807;create()&#20989;&#25968;&#23601;&#21487;&#20197;&#29983;&#25104;&#19968;&#20010;"&#26377;&#34880;&#26377;&#32905;"&#30340;&#23545;&#35937;&#23454;&#20363;. &#36890;&#36807;create()&#20989;&#25968;&#30340;
  &#28304;&#30721;&#30475;&#19968;&#19979;&#36825;&#20010;&#36807;&#31243;&#26159;&#24590;&#20040;&#23454;&#29616;&#30340;. 
<span class="org-block-begin-line">  #+BEGIN_EXAMPLE
</span><span class="org-block">    public &lt;T&gt; T create(final Class&lt;T&gt; service) {
    Utils.validateServiceInterface(service);
    if (validateEagerly) {
      eagerlyValidateMethods(service);
    }
    return (T) Proxy.newProxyInstance(service.getClassLoader(), new Class&lt;?&gt;[] { service },
        new InvocationHandler() {
          private final Platform platform = Platform.get();

          @Override public Object invoke(Object proxy, Method method, Object... args)
              throws Throwable {
            // If the method is a method from Object then defer to normal invocation.
            if (method.getDeclaringClass() == Object.class) {
              return method.invoke(this, args);
            }
            if (platform.isDefaultMethod(method)) {
              return platform.invokeDefaultMethod(method, service, proxy, args);
            }
            ServiceMethod serviceMethod = loadServiceMethod(method);
            OkHttpCall okHttpCall = new OkHttpCall&lt;&gt;(serviceMethod, args);
            return serviceMethod.callAdapter.adapt(okHttpCall);
          }
        });
  }
</span><span class="org-block-end-line">  #+END_EXAMPLE
</span>
  &#21069;&#38754;&#30340;"if"&#35821;&#21477;&#26242;&#26102;&#20808;&#19981;&#31649;, &#26368;&#21518;&#30340; "return" &#36820;&#22238;&#20102;&#19968;&#20010; <span class="org-code">~Proxy.newProxyInstance()~</span>
  &#20989;&#25968;&#30340;&#32467;&#26524;, &#36825;&#37324;&#20351;&#29992;&#21040;&#20102;java&#30340; <span class="org-link"><a href="&#21160;&#24577;&#20195;&#29702;&#20171;&#32461;">&#21160;&#24577;&#20195;&#29702;</a></span> &#30340;&#32534;&#31243;&#25216;&#24039;. &#36890;&#36807;&#35813;&#20989;&#25968;, &#25105;&#20204;&#21487;&#20197;&#25343;&#21040;&#19968;&#20010;
  &#21069;&#38754;&#33258;&#23450;&#20041;&#30340; "Client" &#30340;&#19968;&#20010; <span class="bold">*&#20195;&#29702;&#31867;*</span>, &#20854;&#21151;&#33021;&#23601;&#30456;&#24403;&#20110;&#19968;&#20010;Client&#23545;&#35937;, &#21363;&#25105;&#20204;&#21487;&#20197;&#36890;&#36807;
  &#23427;&#35843;&#29992;Client&#37324;&#30340;&#21508;&#20010;&#25104;&#21592;&#20989;&#25968;. 
  
  &#36825;&#37324;&#26368;&#37325;&#35201;&#30340;&#26159;&#20854;&#31532;&#19977;&#20010;&#21442;&#25968;, &#35813;&#21442;&#25968;&#26159;&#19968;&#20010;&#21311;&#21517;&#30340; <span class="bold">*InvocationHandler()*</span>,
  &#35813;&#31867;&#30340;&#24847;&#20041;&#22312;&#20110;: &#24403;&#25105;&#20204;&#36890;&#36807;&#20195;&#29702;&#31867;&#35843;&#29992;&#25104;&#21592;&#20989;&#25968;&#26102;, &#26368;&#21518;&#35843;&#29992;&#30340;&#20854;&#23454;&#26159;&#35813;&#21311;&#21517;&#31867;&#30340;
  invoke()&#20989;&#25968;, &#35813;&#20989;&#25968;&#30340;&#21442;&#25968;method&#23601;&#26159;Client&#31867;&#30340;&#26041;&#27861;, &#21442;&#25968;&#23601;&#26159;Client&#31867;&#30340;&#21442;&#25968;.
  &#36825;&#23601;&#26159;&#25105;&#20204;&#21487;&#20197;&#36890;&#36807;retrofit&#23454;&#29616;&#19968;&#20010;interface&#23454;&#20363;&#30340;&#26680;&#24515;&#20195;&#30721;. &#33267;&#20110;&#24590;&#20040;&#36890;&#36807;&#35843;&#29992;
  &#20855;&#20307;&#30340;&#20989;&#25968;&#23454;&#29616;&#23454;&#38469;&#30340;http&#35831;&#27714;, &#21017;&#38656;&#35201;&#30475;&#19968;&#19979; invoke() &#30340;&#20855;&#20307;&#23454;&#29616;. &#22312;&#35813;&#20989;&#25968;&#30340;&#23454;&#29616;&#37324;,
  &#26368;&#37325;&#35201;&#30340;&#23601;&#26159;&#36825;&#20960;&#34892;. 
<span class="org-block-begin-line">  #+BEGIN_EXAMPLE
</span><span class="org-block">  ServiceMethod serviceMethod = loadServiceMethod(method);
  OkHttpCall okHttpCall = new OkHttpCall&lt;&gt;(serviceMethod, args);
  return serviceMethod.callAdapter.adapt(okHttpCall);
</span><span class="org-block-end-line">  #+END_EXAMPLE
</span><span class="org-level-1">* &#36890;&#36807;invoke()&#25191;&#34892;&#20989;&#25968;, &#36820;&#22238;&#19968;&#20010;Call</span>
<span class="org-level-2">** &#20989;&#25968;&#30340;&#23553;&#35013;&#31867;:ServiceMethod</span>
   &#22312;<span class="org-link"><a href="&#22522;&#20110;&#33258;&#23450;&#20041;interface&#21019;&#24314;&#23454;&#20363;">&#19978;&#19968;&#33410;</a></span>&#30340;&#26368;&#21518;,&#25552;&#21040;&#20102;&#20855;&#20307;&#33258;&#23450;&#20041;service &#30340;&#25104;&#21592;&#20989;&#25968;&#35843;&#29992;&#19982;invoke()&#20989;&#25968;
   &#30340;&#21518;&#20960;&#34892;&#26377;&#20851;, &#36825;&#37324;&#20808;&#30475;&#19968;&#19979;&#31532;&#19968;&#34892;&#20195;&#30721; <span class="org-code">~ServiceMethod serviceMethod = loadServiceMethod(method);~</span> .

   ServiceMethod&#31867;&#26159;&#20989;&#25968;&#30340;&#23553;&#35013;&#31867;, &#23427;&#20445;&#23384;&#20102;&#25105;&#20204;&#22312;&#25509;&#21475;&#20013;&#23450;&#20041;&#30340;&#20989;&#25968;&#30340;&#25152;&#26377;&#20449;&#24687;(&#21069;&#38754;&#20363;&#23376;&#20013;&#25105;&#20204;&#23450;&#20041;&#20102;&#20989;&#25968; <span class="bold">*getUsers()*</span> ),
   &#21253;&#25324;&#22914;&#19979;&#20869;&#23481;:
   <span class="org-table">| &#20869;&#23481;       | note                                                      |</span>
   <span class="org-table">|------------+-----------------------------------------------------------|</span>
   <span class="org-table">| &#35831;&#27714;&#26041;&#27861;   | &#22914;POST/GET                                                |</span>
   <span class="org-table">| &#35831;&#27714;&#20307;     |                                                           |</span>
   <span class="org-table">| &#35831;&#27714;&#30340;url  | base + &#30456;&#23545;&#22320;&#22336;                                           |</span>
   <span class="org-table">| &#35831;&#27714;&#22836;&#37096;   |                                                           |</span>
   <span class="org-table">| &#20989;&#25968;&#21442;&#25968;   | &#21442;&#25968;&#20063;&#20250;&#34987;"&#27880;&#35299;"&#20462;&#39280;                                      |</span>
   <span class="org-table">| &#20989;&#25968;&#36820;&#22238;&#20540; | &#19968;&#33324;&#20026;Call                                                   |</span>
   <span class="org-table">| other      | &#19968;&#20123;&#20855;&#20307;&#30340;http&#21327;&#35758;&#30456;&#20851;&#30340;&#20869;&#23481;, &#20363;&#22914;&#26159;&#21542;&#20026;multipart, form&#31561; |</span>
 
   &#24403;&#35843;&#29992; loadServiceMethod()&#20989;&#25968;&#26102;, &#23454;&#38469;&#23601;&#26159;&#22522;&#20110;&#22788;&#29702;&#36825;&#20010;&#20989;&#25968;&#30340;&#25152;&#26377;&#20449;&#24687;, 
   &#36825;&#20123;&#20449;&#24687;&#26159;&#21487;&#20197;&#36890;&#36807;java&#30340;Method&#31867;&#25343;&#21040;&#30340;. 

   &#23545;&#20110;ServiceMethod&#31867;&#30340;&#20855;&#20307;&#22788;&#29702;&#36807;&#31243;, &#20250;&#22312;&#19979;&#19968;&#31687;&#25991;&#31456;&#35762;&#36848;.

<span class="org-level-2">** &#25191;&#34892;&#20989;&#25968;, &#33719;&#21462;&#36820;&#22238;&#20540;(Call)</span>
   &#22312;invoke()&#20989;&#25968;&#30340;&#26368;&#21518;&#20004;&#34892;, &#39318;&#20808;&#22522;&#20110;&#36890;&#36807;&#20998;&#26512;&#20989;&#25968;&#29983;&#25104;&#30340;ServiceMethod&#23454;&#20363;&#26469;
   &#21019;&#24314;&#19968;&#20010;OkHttpClient&#23545;&#35937;, &#28982;&#21518;&#35843;&#29992;&#20195;&#30721; <span class="org-code">~return serviceMethod.callAdapter.adapt(okHttpCall);~</span>
   &#26469;&#23436;&#25104;"&#20195;&#29702;"&#30340;&#20316;&#29992;, &#36825;&#20010;invoke()&#30340;&#36820;&#22238;&#20540;"&#31561;&#21516;&#20110;"&#25105;&#20204;&#35843;&#29992;&#33258;&#23450;&#20041;&#20989;&#25968;&#30340;&#36820;&#22238;&#20540;. 
   invoke()&#30340;&#36820;&#22238;&#20540;&#24635;&#26159;Object&#31867;&#22411;, &#23558;&#20854;&#36716;&#25442;&#20026;&#33258;&#23450;&#20041;&#20989;&#25968;&#30340;&#36820;&#22238;&#20540;&#31867;&#22411;&#21363;&#21487;.
   &#19968;&#33324;&#36825;&#20010;&#36820;&#22238;&#20540;&#37117;&#20026;Call&#31867;&#22411;. 

   &#36825;&#37324;&#20027;&#35201;&#30475;&#19968;&#19979;&#26368;&#21518;&#19968;&#34892;&#20195;&#30721;. &#36825;&#34892;&#20195;&#30721;&#21487;&#20197;&#20998;&#25104;&#20004;&#37096;&#20998;&#35762;&#35299;:
   1. serviceMethod&#30340;callAdapter&#21464;&#37327;.
   2. callAdapter&#21464;&#37327;&#30340;adapt()&#20989;&#25968;
<span class="org-level-2">** ServiceMethod&#30340;callAdapter&#21464;&#37327;</span>
   CallAdapter&#26159;Call&#30340;&#36866;&#37197;&#22120;&#31867;, &#22312;&#23558;&#19968;&#20010;&#33258;&#23450;&#20041;&#20989;&#25968;&#35299;&#26512;&#25104;ServiceMethod&#23454;&#20363;&#26102;, 
   &#20250;&#29983;&#25104;&#36825;&#20010;ServiceMethod&#30340;callAdapter&#21464;&#37327;. &#19979;&#38754;&#30340;&#20195;&#30721;&#23637;&#31034;&#20102;&#21019;&#24314;&#36807;&#31243;.
<span class="org-block-begin-line">   #+BEGIN_EXAMPLE
</span><span class="org-block">   //SeviceMethod.java
    private CallAdapter&lt;?&gt; createCallAdapter() {
      Type returnType = method.getGenericReturnType();
      if (Utils.hasUnresolvableType(returnType)) {
        throw methodError(
            "Method return type must not include a type variable or wildcard: %s", returnType);
      }
      if (returnType == void.class) {
        throw methodError("Service methods cannot return void.");
      }
      Annotation[] annotations = method.getAnnotations();
      try {
        return retrofit.callAdapter(returnType, annotations);
      } catch (RuntimeException e) { // Wide exception range because factories are user code.
        throw methodError(e, "Unable to create call adapter for %s", returnType);
      }
    }
  //Retrofit.java 
  public CallAdapter&lt;?&gt; nextCallAdapter(CallAdapter.Factory skipPast, Type returnType,
      Annotation[] annotations) {
    checkNotNull(returnType, "returnType == null");
    checkNotNull(annotations, "annotations == null");

    int start = adapterFactories.indexOf(skipPast) + 1;
    for (int i = start, count = adapterFactories.size(); i &lt; count; i++) {
      CallAdapter&lt;?&gt; adapter = adapterFactories.get(i).get(returnType, annotations, this);
      if (adapter != null) {
        return adapter;
      }
    }
</span><span class="org-block-end-line">   #+END_EXAMPLE
</span>   
   &#19978;&#38754;&#30340;&#20195;&#30721;&#26159;callAdapter&#21464;&#37327;&#30340;&#21019;&#24314;&#36807;&#31243;, &#31532;&#19968;&#20010;&#20989;&#25968; <span class="org-code">~createCallAdapter()~</span> &#39318;&#20808;
   &#33719;&#21462;&#20102;&#20989;&#25968;&#30340;"&#36820;&#22238;&#31867;&#22411;"&#21644;"&#27880;&#35299;", &#24182;&#22522;&#20110;&#36825;&#20004;&#20010;&#20869;&#23481;&#35843;&#29992;Retrofit&#30340; <span class="org-code">~callAdapter()~</span>
   &#20989;&#25968;, &#24182;&#26368;&#32456;&#35843;&#29992;&#20102; <span class="org-code">~nextCallAdapter()~</span> &#20989;&#25968;. &#21518;&#32773;&#20250;&#26816;&#26597;retrofit&#30340;adapterFactories
   &#21464;&#37327;&#20013;&#26159;&#21542;&#21253;&#21547;&#33021;&#22815;&#21305;&#37197;&#36825;&#20010;&#36820;&#22238;&#20540;&#31867;&#22411;&#21644;&#27880;&#35299;&#30340;CallAdapter, &#24182;&#36820;&#22238;. 
   &#37027;&#20040;&#38382;&#39064;&#26469;&#20102;: &#36825;&#20010;adapterFactories&#20013;&#21040;&#24213;&#26377;&#27809;&#26377;&#21305;&#37197;&#33021;&#22815;&#21305;&#37197;&#36820;&#22238;&#31867;&#22411;&#21644;&#27880;&#35299;&#30340;CallAdapter&#21602;?
   &#36825;&#23601;&#35201;&#30475;&#19968;&#19979;&#36825;&#20010; factory &#30340;&#20855;&#20307;&#23454;&#29616;&#36807;&#31243;.
<span class="org-level-1">* Retrofit&#30340;adapterFactories&#30340;&#30495;&#23454;&#38754;&#30446;</span>
&#27880;:&#36825;&#37324;&#21482;&#35299;&#37322;&#20102;Android&#24179;&#21488;&#30340;&#24773;&#20917;.

adapterFactories&#21464;&#37327;&#26159;&#22312;retrofit&#30340;builder&#20013;&#21021;&#22987;&#21270;&#30340;,
builder&#25552;&#20379;&#20102;&#19968;&#20010; <span class="org-code">~addCallAdapterFactory()~</span>
&#20989;&#25968;&#21487;&#20197;&#35753;&#20351;&#29992;&#32773;&#21521;factories&#28155;&#21152;&#33258;&#23450;&#20041;CallAdapter, <span class="bold">*&#21516;&#26102;*</span> ,
&#22312;&#26368;&#21518;&#30340;build()&#38454;&#27573;,&#20250;&#23558;&#35813;<span class="org-link"><a href="&#24403;&#21069;&#36816;&#34892;&#24179;&#21488;">&#24403;&#21069;&#36816;&#34892;&#24179;&#21488;</a></span>&#30340;&#40664;&#35748;CallAdapterFactory
&#28155;&#21152;&#21040;fatories&#37324;. &#36825;&#37324;&#20551;&#35774;&#25105;&#20204;&#27809;&#26377;&#28155;&#21152;&#20219;&#20309;&#33258;&#23450;&#20041;CallAdapter, 
&#37027;&#20040;factories&#37324;&#21482;&#26377;&#24179;&#21488;&#30340;&#40664;&#35748;CallAdapterFacotry&#20102;. 

&#23545;&#20110;Android &#24179;&#21488;&#26469;&#35828;, &#36825;&#20010;"&#40664;&#35748;"&#30340;CallAdapterFactory&#20195;&#30721;&#22914;&#19979;,
&#35813;&#20989;&#25968;&#36820;&#22238;&#19968;&#20010;ExecutorCallAdapterFactory&#23454;&#20363;. 
<span class="org-block-begin-line">#+BEGIN_EXAMPLE
</span><span class="org-block">//Android platform
    @Override CallAdapter.Factory defaultCallAdapterFactory(Executor callbackExecutor) {
      return new ExecutorCallAdapterFactory(callbackExecutor);
    }
</span><span class="org-block-end-line">#+END_EXAMPLE
</span>&#26681;&#25454;<span class="org-link"><a href="ServiceMethod&#30340;callAdapter&#21464;&#37327;">&#21069;&#38754;</a></span>&#30340;&#20869;&#23481;,&#24403;&#23545;&#35813;&#23454;&#20363;&#35843;&#29992; <span class="org-code">~get()~</span> &#20989;&#25968;&#26102;, &#22914;&#20309;&#36820;&#22238;&#19968;&#20010;
&#21487;&#20197;&#36866;&#37197;"&#36820;&#22238;&#31867;&#22411;"&#21644;"&#20989;&#25968;&#27880;&#35299;"&#30340;CallAdapter&#23454;&#20363;, &#36825;&#23601;&#35201;&#30475;&#19979;
<span class="bold">*ExecutorCallAdapterFactory*</span> &#30340;&#20855;&#20307;&#23454;&#29616;, &#20854;&#20195;&#30721;&#22914;&#19979;. 
&#20174;&#20195;&#30721;&#21487;&#20197;&#30475;&#20986;, &#23545;&#20110;&#20219;&#20309;&#33258;&#23450;&#20041;&#20989;&#25968;, &#21482;&#35201;&#20854;&#36820;&#22238;&#31867;&#22411;&#20026;"Call"&#31867;,
&#37027;&#20040;&#37117;&#20250;&#29983;&#25104;&#19968;&#20010;&#21311;&#21517;&#30340;"CallAdapter"&#23454;&#20363;.&#35813;&#23454;&#20363;&#23454;&#29616;&#20102; <span class="org-code">~adapter()~</span>
&#26041;&#27861;, &#20351;&#20854;&#21487;&#20197;&#36820;&#22238;&#19968;&#20010;&#20855;&#20307;&#30340;Call&#30340;&#23376;&#31867;, &#21363; ExecutorCallbackCall(). 
<span class="org-block-begin-line">#+BEGIN_EXAMPLE
</span><span class="org-block">  @Override
  public CallAdapter&lt;Call&lt;?&gt;&gt; get(Type returnType, Annotation[] annotations, Retrofit retrofit) {
    if (getRawType(returnType) != Call.class) {
      return null;
    }
    final Type responseType = Utils.getCallResponseType(returnType);
    return new CallAdapter&lt;Call&lt;?&gt;&gt;() {
      @Override public Type responseType() {
        return responseType;
      }

      @Override public &lt;R&gt; Call&lt;R&gt; adapt(Call&lt;R&gt; call) {
        return new ExecutorCallbackCall&lt;&gt;(callbackExecutor, call);
      }
    };
  }
</span><span class="org-block-end-line">#+END_EXAMPLE
</span>
&#20197;&#19978;&#23601;&#26159;&#35843;&#29992;&#33258;&#23450;&#20041;interface&#30340;&#20855;&#20307;&#26576;&#20010;&#20989;&#25968;&#30340;&#36807;&#31243;, &#20197;Android&#24179;&#21488;&#20026;&#20363;, &#36890;&#36807;&#35843;&#29992;&#20989;&#25968;,
&#26368;&#32456;&#20250;&#33719;&#24471;&#19968;&#20010;ExecutorCallbackCall&#23454;&#20363;. &#36890;&#36807;&#36825;&#20010;Call&#23454;&#20363;, &#25105;&#20204;&#23601;&#21487;&#20197;&#23454;&#29616;&#20855;&#20307;&#30340;Http&#35831;&#27714;.
<span class="org-level-1">* &#25191;&#34892;&#20855;&#20307;&#30340;Http&#35831;&#27714;</span>
&#36890;&#36807;&#21069;&#38754;&#30340;&#20869;&#23481;, &#24050;&#32463;&#30693;&#36947;&#35843;&#29992;&#20989;&#25968;&#21487;&#20197;&#33719;&#24471;&#19968;&#20010;ExecutorCallbackCall&#23454;&#20363;, 
&#37027;&#20040;&#23601;&#21487;&#20197;&#36890;&#36807;&#25191;&#34892;&#35813;&#23454;&#20363;&#30340;execute()&#25110;enqueue()&#20989;&#25968;&#25191;&#34892;&#20855;&#20307;&#30340;http&#35831;&#27714;&#20102;.
&#36825;&#19968;&#37096;&#20998;&#26159;OkHttp&#30456;&#20851;&#30340;&#20869;&#23481;, &#20250;&#22312;&#21518;&#38754;&#25991;&#31456;&#38470;&#32493;&#35828;&#26126;.
<span class="org-block-begin-line">#+BEGIN_EXAMPLE
</span><span class="org-block">//&#20855;&#20307;&#35831;&#27714;&#20195;&#30721;
List&lt;Users&gt; result = call.execute().body();
</span><span class="org-block-end-line">#+END_EXAMPLE
</span>
&#36825;&#37324;&#24819;&#34917;&#20805;&#19968;&#19979;ExecutorCallbackCall&#31867;&#30340;&#19968;&#20010;&#21464;&#37327;: callbackExecutor. 

&#22312;Retrofit&#30340;&#35774;&#35745;&#20013;,&#36890;&#36807;Call&#36827;&#34892;http&#35831;&#27714;&#26377;&#20004;&#31181;&#26041;&#27861;: execute()&#21644;enqueue().
&#21069;&#32773;&#26159;&#21516;&#27493;&#35831;&#27714;, &#21518;&#32773;&#26159;&#24322;&#27493;&#35831;&#27714;. &#23545;&#20110;&#24322;&#27493;&#35831;&#27714;, &#38656;&#35201;&#20256;&#36882;&#19968;&#20010;callback&#21442;&#25968;&#36827;&#34892;
&#22238;&#35843;, &#22788;&#29702;&#36820;&#22238;&#32467;&#26524;. &#22312;ExecutorCallbackCall&#20013;, &#22238;&#35843;&#30340;&#20855;&#20307;&#22788;&#29702;&#36807;&#31243;&#23601;&#26159;&#36890;&#36807;
&#21464;&#37327; <span class="bold">*callbackExecutor*</span> &#23436;&#25104;&#30340;. &#22240;&#20026;ExecutorCallbackCall&#23545;&#24212;&#30340;&#26159;Android&#24179;&#21488;,
&#25152;&#20197;&#25105;&#20204;&#26469;&#30475;&#19968;&#19979;&#36825;&#20010; callbackExecutor &#26377;&#20160;&#20040;&#29305;&#27530;&#20043;&#22788;. 
&#19979;&#38754;&#30340;&#20195;&#30721;&#36861;&#28335;&#20102;&#36825;&#20010;&#21464;&#37327;&#30340;&#26368;&#32456;&#20986;&#22788;.
<span class="org-block-begin-line">#+BEGIN_EXAMPLE
</span><span class="org-block">//Android&#24179;&#21488;&#36890;&#36807;&#35813;&#20989;&#25968;&#21019;&#24314;factory
    @Override CallAdapter.Factory defaultCallAdapterFactory(Executor callbackExecutor) {
      return new ExecutorCallAdapterFactory(callbackExecutor);
    }

//Retrofit&#22312;builder&#20013;&#35843;&#29992;&#20102;&#19978;&#38754;&#30340;&#20989;&#25968;, &#24182;&#20256;&#20837;&#20102;executor&#21442;&#25968;
adapterFactories.add(platform.defaultCallAdapterFactory(callbackExecutor));

//builder&#30340;callbackExecutor&#30340;&#21019;&#24314;, &#35843;&#29992;&#20102;&#24179;&#21488;&#30340;&#30456;&#20851;&#20989;&#25968;
callbackExecutor = platform.defaultCallbackExecutor();

//&#24179;&#21488;&#30456;&#20851;&#20989;&#25968;&#30340;&#23454;&#29616;
    @Override public Executor defaultCallbackExecutor() {
      return new MainThreadExecutor();
    }
    static class MainThreadExecutor implements Executor {
      private final Handler handler = new Handler(Looper.getMainLooper());

      @Override public void execute(Runnable r) {
        handler.post(r);
      }
    }
</span><span class="org-block-end-line">#+END_EXAMPLE
</span>&#36890;&#36807;&#19978;&#38754;&#20195;&#30721;&#21487;&#20197;&#30475;&#20986;, Android&#24179;&#21488;&#30340;&#36825;&#20010;executor&#20854;&#23454;&#26159;&#19968;&#20010;&#24102;&#26377;UI&#32447;&#31243;handler&#30340;
executor, &#25152;&#20197;&#26368;&#21518;&#25191;&#34892;execute&#26102;, &#20250;&#23558;runnable&#20256;&#32473;UI&#32447;&#31243;&#25191;&#34892;. &#21363;,&#24403;&#35843;&#29992;enqueue()
&#20989;&#25968;&#26102;, &#22238;&#35843;&#26159;&#22312;UI&#32447;&#31243;&#20013;&#25191;&#34892;&#30340;.

over.
<span class="org-level-1">* &#38468;&#27880;:</span>
<span class="org-level-2">** &#21160;&#24577;&#20195;&#29702;&#20171;&#32461;</span>
   &#21160;&#24577;&#20195;&#29702;&#26426;&#21046;&#26159;Java&#30340;&#19968;&#20010;&#39640;&#32423;&#29305;&#24615;, &#20854;&#20027;&#35201;&#21151;&#33021;&#23601;&#26159;&#21487;&#20197;&#20026;&#22996;&#25176;&#31867;&#23545;&#35937;&#29983;&#25104;&#20195;&#29702;&#31867;,
   &#20195;&#29702;&#31867;&#21487;&#20197;&#23558;&#25152;&#26377;&#30340;&#26041;&#27861;&#35843;&#29992;&#20998;&#27966;&#21040;&#22996;&#25176;&#23545;&#35937;&#19978;&#21453;&#23556;&#25191;&#34892;. &#21160;&#24577;&#20195;&#29702;&#30340;&#30456;&#20851;&#30693;&#35782;&#21487;&#21442;&#32771;
   &#30456;&#20851;&#30340;Java&#20070;&#31821;. &#36825;&#37324;&#20256;&#20837;newProxyInstance()&#26377;&#19977;&#20010;&#21442;&#25968;: 1, &#25509;&#21475;&#30340;classLoader. 2, 
   &#21482;&#21253;&#21547;&#25509;&#21475;&#30340;class&#25968;&#32452;. 3, &#33258;&#23450;&#20041;&#30340;InvocationHandler()&#23545;&#35937;, &#35813;&#23545;&#35937;&#23454;&#29616;&#20102;invoke()
   &#20989;&#25968;, &#36890;&#24120;&#22312;&#35813;&#20989;&#25968;&#20013;&#23454;&#29616;&#23545;&#22996;&#25176;&#31867;&#20989;&#25968;&#30340;&#35775;&#38382;. &#25152;&#20197;&#20174;create&#20989;&#25968;&#21487;&#20197;&#30475;&#20986;, *&#20854;&#23454;&#35813;&#20989;&#25968;
   &#36820;&#22238;&#30340;&#26159;&#19968;&#20010;&#21160;&#24577;&#20195;&#29702;&#31867;&#23545;&#35937;(&#34987;&#36716;&#21270;&#25104;&#20102;&#25105;&#20204;&#33258;&#23450;&#20041;&#30340;&#25509;&#21475;), &#24403;&#25105;&#20204;&#35843;&#29992;&#35813;&#25509;&#21475;&#30340;&#33258;&#23450;&#20041;
   &#20989;&#25968;&#26102;, &#25105;&#20204;&#35843;&#29992;&#30340;&#23454;&#38469;&#26159;invoke()&#20989;&#25968;.* &#32780;&#35201;&#25191;&#34892;&#30340;&#26041;&#27861;&#34987;&#24403;&#20316;&#21442;&#25968;&#20256;&#32473;&#20102;invoke.
</pre>
  </body>
</html>
