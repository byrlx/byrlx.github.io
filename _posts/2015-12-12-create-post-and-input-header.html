---
layout: post
title: 自动创建文章并设置Header
categories: [Emacs]
tag: [Lisp]
---

<p>
用org mode写Jekyll博客需要在文章开头设置一些HTML export的配置,
每次写文章都写一遍, 很繁琐, 故写了一个elisp 程序自动实现
这个步骤. 
</p>

<div id="outline-container-sec-1" class="outline-2">
<h2 id="sec-1">header配置模板</h2>
<div class="outline-text-2" id="text-1">
<p>
下面是博客文章开头的设置模板,
将模板插入到文章头部后, 要根据命令参数自动
生成title和category.
</p>

<pre class="example">
#+OPTIONS: num:nil
#+OPTIONS: ^:nil
#+OPTIONS: H:nil
#+OPTIONS: toc:nil
#+AUTHOR: Zhengchao Xu
#+EMAIL: xuzhengchaojob@gmail.com

#+BEGIN_HTML
---
layout: post
title: 
categories: 
---
#+END_HTML
</pre>
</div>
</div>



<div id="outline-container-sec-2" class="outline-2">
<h2 id="sec-2">编程实现</h2>
<div class="outline-text-2" id="text-2">
<p>
定义了两个函数来实现这个功能, 并将其设置为命令, 
可以通过"M-x"来调用. 这两个函数为:
lx-create-post-today, lx-creat-post. 第一个函数需要
输入"title"和"category". 第二个函数需要输入"date",
"title"和"category"三个函数. 
</p>
</div>
<div id="outline-container-sec-2-1" class="outline-3">
<h3 id="sec-2-1">lx-create-post-today (title category)</h3>
<div class="outline-text-3" id="text-2-1">
<p>
该函数实际上调用了lx-create-post这个函数, 所以其代码比较简单:
</p>
<div class="org-src-container">

<pre class="src src-elisp">(defun lx-create-post-today (title category)
  (interactive "sInput title:\nsInput category: ")
  (lx-create-post (format-time-string "%Y-%m-%d") title category))
</pre>
</div>

<p>
执行"M-x", 输入命令 <img src="../../../public/img/cmd.png" alt="cmd.png" />
</p>

<p>
提示输入title <img src="../../../public/img/title.png" alt="title.png" />
</p>

<p>
提示输入category. <img src="../../../public/img/category.png" alt="category.png" />
</p>

<p>
输入完成后, 会基于当前的日期, 创建文件名为"date-title.org"的文件,
并将参数插入到模板的title和category的对应位置.  
</p>


<div class="figure">
<p><img src="../../../public/img/header.png" alt="header.png" />
</p>
</div>
</div>
</div>

<div id="outline-container-sec-2-2" class="outline-3">
<h3 id="sec-2-2">lx-create-post (date title category)</h3>
<div class="outline-text-3" id="text-2-2">
<p>
该函数的代码实现如下,
</p>

<div class="org-src-container">

<pre class="src src-elisp">(defun lx-create-post (date title category)
  (interactive "Input date title and category: %s %s %s")
  ;; 组装文件名
  (setq whole-filename (concat ORG-PATH "blog/" date "-" title ".org"))
  ;; 创建文件, 打开文件
  (setq filebuf (find-file-other-window whole-filename))
  ;; 插入通用头部
  (lx-create-post-head title category)
  ;; 光标定位在头部下边的空白行
  )
</pre>
</div>

<p>
代码解释:
</p>
<ul class="org-ul">
<li>首先提示输入"date", "title"和"category".
</li>
<li>将日期和tilte组装成文件名
</li>
<li>调用file-file-other-window创建并在新窗口打开文件
</li>
<li>调用lx-create-post-head插入head模板
</li>
</ul>
</div>
</div>

<div id="outline-container-sec-2-3" class="outline-3">
<h3 id="sec-2-3">lx-create-post-head (title category)</h3>
<div class="outline-text-3" id="text-2-3">
<p>
该函数用于插入和修改head模板
</p>
<pre class="example">
;; 根据title和category生成头部
(defun lx-create-post-head (title category)
  ;;读取头部文件内容并插入到文件开始
  (insert-file-contents "~/lx/GoogleDrive/lxorg/blog/header")
  ;;移动光标, 填写标题和category
  (goto-char (point-max))
  (forward-line -3)
  (end-of-line)
  (insert (concat "[" category "]"))
  (forward-line -1)
  (end-of-line)
  (insert title)
  )
</pre>
<p>
代码解释:
</p>
<ul class="org-ul">
<li>调用insert-file-contents 插入header模板
</li>
<li>移动光标到最后一行
</li>
<li>移动光标到前三行: category的那一行
</li>
<li>移动到该行尾部并插入category参数
</li>
<li>同样的方法插入title
</li>
</ul>
</div>
</div>
</div>
