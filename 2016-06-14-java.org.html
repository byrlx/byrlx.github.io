<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN">
<!-- Created by htmlize-1.43 in css mode. -->
<html>
  <head>
    <title>2016-06-14-java.org</title>
    <style type="text/css">
    <!--
      body {
        color: #DCDCCC;
        background-color: #3F3F3F;
      }
      .org-block {
        /* org-block */
        color: #009acd;
      }
      .org-block-begin-line {
        /* org-block-begin-line */
        color: #7F9F7F;
      }
      .org-block-end-line {
        /* org-block-end-line */
        color: #7F9F7F;
      }
      .org-document-info {
        /* org-document-info */
        color: #afeeee;
      }
      .org-document-info-keyword {
        /* org-document-info-keyword */
        color: #b3b3b3;
      }
      .org-level-1 {
        /* org-level-1 */
        color: #DFAF8F;
        font-size: 130%;
        text-decoration: overline;
      }
      .org-meta-line {
        /* org-meta-line */
        color: #7F9F7F;
      }
      .org-table {
        /* org-table */
        color: #9FC59F;
      }

      a {
        color: inherit;
        background-color: inherit;
        font: inherit;
        text-decoration: inherit;
      }
      a:hover {
        text-decoration: underline;
      }
    -->
    </style>
  </head>
  <body>
    <pre>
<span class="org-meta-line">#+OPTIONS: num:nil</span>
<span class="org-meta-line">#+OPTIONS: ^:nil</span>
<span class="org-meta-line">#+OPTIONS: H:nil</span>
<span class="org-meta-line">#+OPTIONS: toc:nil</span>
<span class="org-document-info-keyword">#+AUTHOR:</span> <span class="org-document-info">Zhengchao Xu
</span><span class="org-document-info-keyword">#+EMAIL:</span> <span class="org-document-info">xuzhengchaojob@gmail.com
</span>
<span class="org-block-begin-line">#+BEGIN_HTML
</span><span class="org-block">---
layout: post
title: Java&#29712;&#30862;&#31508;&#35760;
categories: [Java]
---
</span><span class="org-block-end-line">#+END_HTML
</span>
<span class="org-level-1">* FutureTask</span>
1. FutureTask&#30340;&#29366;&#24577;&#20351;&#29992;&#20102; "volatile" &#20462;&#39280;, &#22240;&#20026;task&#21482;&#22312;&#19968;&#20010;&#32447;&#31243;
   &#19978;&#36816;&#34892;, &#25152;&#20197;&#21482;&#26377;&#36825;&#20010;&#32447;&#31243;&#25165;&#20250;&#20462;&#25913;&#29366;&#24577;. &#25152;&#20197;&#21487;&#20197;&#29992;volatile.
2. &#21482;&#35201;state!=NEW, idDone()&#20989;&#25968;&#21363;&#36820;&#22238;true.
3. 
<span class="org-level-1">* ThreadPoolExecutor</span>
1. state&#21644;worker&#29992;&#19968;&#20010;int&#34920;&#31034;,mask 29&#20301;, &#23545;&#24212;&#30340;bit&#20540;&#20026;.
   <span class="org-table">|            |        |</span>
   <span class="org-table">|------------+--------|</span>
   <span class="org-table">| RUNNING    | -1&lt;&lt;29 |</span>
   <span class="org-table">| SHUTTING   | 0&lt;&lt;29  |</span>
   <span class="org-table">| STOP       | 1&lt;&lt;29  |</span>
   <span class="org-table">| TYDYING    | 2&lt;&lt;29  |</span>
   <span class="org-table">| TERMINATED | 3&lt;&lt;29  |</span>
2. &#36890;&#36807;submit()&#20989;&#25968;&#28155;&#21152;&#19968;&#20010;Runnable&#25110;Callable, &#35813;&#20989;&#25968;&#20869;&#37096;&#20250;
   &#35843;&#29992;execute()&#20989;&#25968;&#25191;&#34892;. &#35813;&#20989;&#25968;&#30340;&#27969;&#31243;:
   1. &#21028;&#26029;&#24403;&#21069;&#30340;worker&#25968;&#37327;&#26159;&#21542;&#23567;&#20110;coolPoolSize, &#22914;&#26524;&#26159;.
      1. &#23581;&#35797;&#35843;&#29992;addWorker()&#20989;&#25968;&#21019;&#24314;&#19968;&#20010;&#26032;&#30340;worker(&#26032;worker&#22312;&#26500;&#36896;
         &#20989;&#25968;&#20013;&#20250;&#21019;&#24314;&#19968;&#20010;&#26032;&#30340;&#32447;&#31243;&#21464;&#37327;). &#35813;&#20989;&#25968;&#27969;&#31243;:
         1. &#22914;&#26524;&#24403;&#21069;&#29366;&#24577;&#20026;STOP/TIDYING/TERMINATED, &#21017;&#28155;&#21152;&#22833;&#36133;.
         2. &#22914;&#26524;&#24403;&#21069;&#29366;&#24577;&#26159;RUNNING.
            1. &#21442;&#25968;&#20026;Null, &#28155;&#21152;&#22833;&#36133;.
            2. &#24037;&#20316;&#38431;&#21015;&#20026;&#31354;, &#28155;&#21152;&#22833;&#36133;.
         3. &#22914;&#26524;1/2&#37117;&#36890;&#36807;, &#21028;&#26029;&#24403;&#21069;&#30340;worker&#25968;&#26159;&#21542;&#24050;&#21040;&#19978;&#32447;(2^29 - 1).
            &#21040;&#20102;&#21017;&#28155;&#21152;&#22833;&#36133;.
         4. &#26816;&#26597;worker&#25968;&#37327;&#26159;&#21542;&#24050;&#32463;&#21040;&#20102;&#35774;&#32622;&#30340;&#26368;&#22823;&#20540;. &#26159;&#21017;&#28155;&#21152;&#22833;&#36133;.
         5. &#22686;&#21152;workerCount&#30340;&#20540;, &#22914;&#26524;&#25104;&#21151;&#21017;&#36339;&#20986;&#24490;&#29615;. &#22914;&#26524;&#19981;&#25104;&#21151;, &#37325;&#26032;
            &#26816;&#27979;state,&#22914;&#26524;&#19981;&#21516;&#21017;&#36827;&#20837;&#22823;&#24490;&#29615;. &#22914;&#26524;state&#27809;&#25913;, &#21017;&#35828;&#26126;workerCount
            &#22312;&#28155;&#21152;&#26102;&#21457;&#29983;&#20102;&#25913;&#21160;,&#37325;&#26032;&#36208;&#19968;&#36941;&#24490;&#29615;&#26816;&#26597;workCount&#30340;&#20540;.
         6. &#36208;&#21040;&#36825;&#20799;&#35828;&#26126;&#21487;&#20197;&#21019;&#24314;&#19968;&#20010;worker, &#21017;&#21019;&#24314;&#19968;&#20010;worker&#23454;&#20363;.
            &#23558;&#20854;&#28155;&#21152;&#21040;worker set&#20013;. &#36825;&#20010;&#36807;&#31243;&#38656;&#35201;&#25343;&#20303;&#38145;.
         7. &#25191;&#34892;&#26032;worker&#20013;&#30340;&#32447;&#31243;.
         8. &#22914;&#26524;&#26032;worker&#28155;&#21152;&#36807;&#31243;&#22833;&#36133;. &#21017;&#35843;&#29992;addWorkerFailed()&#20989;&#25968;
            &#23558;worker&#20174;set&#20013;&#21024;&#38500;, &#24182;&#35843;&#29992;tryTerminate()&#20989;&#25968;.
3. 
</pre>
  </body>
</html>
