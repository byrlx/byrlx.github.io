<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN">
<!-- Created by htmlize-1.43 in css mode. -->
<html>
  <head>
    <title>2015-11-11-robolectric.org</title>
    <style type="text/css">
    <!--
      body {
        color: #DCDCCC;
        background-color: #3F3F3F;
      }
      .bold {
        /* bold */
        font-weight: bold;
      }
      .c-annotation {
        /* c-annotation-face */
        color: #BFEBBF;
      }
      .comment {
        /* font-lock-comment-face */
        color: #7F9F7F;
      }
      .comment-delimiter {
        /* font-lock-comment-delimiter-face */
        color: #5F7F5F;
      }
      .constant {
        /* font-lock-constant-face */
        color: #BFEBBF;
      }
      .function-name {
        /* font-lock-function-name-face */
        color: #93E0E3;
      }
      .keyword {
        /* font-lock-keyword-face */
        color: #F0DFAF;
        font-weight: bold;
      }
      .org-block {
        /* org-block */
        color: #009acd;
      }
      .org-block-begin-line {
        /* org-block-begin-line */
        color: #7F9F7F;
      }
      .org-block-end-line {
        /* org-block-end-line */
        color: #7F9F7F;
      }
      .org-document-info {
        /* org-document-info */
        color: #afeeee;
      }
      .org-document-info-keyword {
        /* org-document-info-keyword */
        color: #b3b3b3;
      }
      .org-level-1 {
        /* org-level-1 */
        color: #DFAF8F;
        font-size: 130%;
        text-decoration: overline;
      }
      .org-level-2 {
        /* org-level-2 */
        color: #BFEBBF;
        font-size: 120%;
      }
      .org-link {
        /* org-link */
        color: #D0BF8F;
        text-decoration: underline;
      }
      .org-meta-line {
        /* org-meta-line */
        color: #7F9F7F;
      }
      .type {
        /* font-lock-type-face */
        color: #7CB8BB;
      }
      .variable-name {
        /* font-lock-variable-name-face */
        color: #DFAF8F;
      }

      a {
        color: inherit;
        background-color: inherit;
        font: inherit;
        text-decoration: inherit;
      }
      a:hover {
        text-decoration: underline;
      }
    -->
    </style>
  </head>
  <body>
    <pre>
<span class="org-meta-line">#+OPTIONS: num:nil</span>
<span class="org-meta-line">#+OPTIONS: ^:nil</span>
<span class="org-meta-line">#+OPTIONS: H:nil</span>
<span class="org-meta-line">#+OPTIONS: toc:nil</span>
<span class="org-document-info-keyword">#+AUTHOR:</span> <span class="org-document-info">Zhengchao Xu
</span><span class="org-document-info-keyword">#+EMAIL:</span> <span class="org-document-info">xuzhengchaojob@gmail.com
</span>
<span class="org-block-begin-line">#+BEGIN_HTML
</span><span class="org-block">---
layout: post
title: &#20351;&#29992;&#24320;&#28304;&#39033;&#30446;Robolectric&#27979;&#35797;Android&#20195;&#30721;
category: [Android]
tag: [android]
---
</span><span class="org-block-end-line">#+END_HTML
</span>
(&#25345;&#32493;&#26356;&#26032;) 

&#35813;&#39033;&#30446;&#23448;&#32593; <span class="org-link"><a href="http://robolectric.org/">http://robolectric.org/</a></span>. github&#22320;&#22336;: <span class="org-link"><a href="https://github.com/robolectric/robolectric">https://github.com/robolectric/robolectric</a></span>.

&#35813;&#25991;&#31456;&#22522;&#20110;Robolectric3.0

<span class="org-level-1">* &#39033;&#30446;&#20171;&#32461;</span>
Robolectric&#26159;&#19968;&#20010;&#24320;&#28304;&#30340;&#21333;&#20803;&#27979;&#35797;&#26694;&#26550;, &#23427;&#21487;&#20197;&#23454;&#29616;&#30452;&#25509;&#22312;JVM&#37324;&#36305;Android&#30456;&#20851;&#30340;&#27979;&#35797;(Activity/Service),
&#36991;&#20813;Android&#33258;&#23478;&#20986;&#21697;&#30340; <span class="bold">*&#21476;&#32769;*</span> &#30340;&#24517;&#39035;&#35201;&#22312;&#34394;&#25311;&#26426;&#19978;&#36305;&#30340;&#27979;&#35797;. (&#27880;: &#30446;&#21069;&#26469;&#30475;, Android&#30340;&#21518;&#32493;&#29256;&#26412;&#23545;&#27979;&#35797;&#30340;&#25903;&#25345;&#36234;&#26469;&#36234;&#22909;.....)

&#23448;&#32593;&#19978;&#32473;&#20986;&#20102;Robolectric&#30340;&#20960;&#28857;&#29305;&#24615;:
1. &#27169;&#25311;SDK, &#36164;&#28304;&#21644;native&#26041;&#27861;:
   &#24635;&#30340;&#26469;&#35828;, robolectric&#21487;&#20197;&#27169;&#25311;&#34394;&#25311;&#26426;&#29615;&#22659;, &#20351;&#20320;&#21487;&#20197;&#22312;
   JVM&#23601;&#21487;&#20197;&#23454;&#29616;&#22823;&#37096;&#20998;&#27979;&#35797;. 
2. &#25670;&#33073;&#34394;&#25311;&#26426;&#30340;&#26463;&#32538;.
   &#30465;&#21435;&#32534;&#35793;/&#25171;&#21253;/&#23433;&#35013;&#27969;&#31243;, &#21152;&#24555;&#27979;&#35797;&#21644;&#37325;&#26500;&#36895;&#24230;.
3. &#19981;&#38656;&#35201;Mocking&#26694;&#26550;
   
<span class="org-level-1">* &#31616;&#21333;&#30340;&#27979;&#35797;&#39033;&#30446;</span>
<span class="org-level-2">** &#21152;&#20837;&#21040;&#39033;&#30446;&#24037;&#31243;</span>
&#28155;&#21152;robolectric&#30340;&#20381;&#36182;, &#30001;&#20110;&#35201;&#20351;&#29992;Junit&#21644;assert&#30456;&#20851;&#30340;&#20989;&#25968;,
&#25152;&#20197;&#25226;&#20182;&#20204;&#30340;&#20381;&#36182;&#20063;&#19968;&#36215;&#21152;&#19978;.
<span class="org-block-begin-line">#+BEGIN_SRC xml
</span>    testCompile 'junit:junit:4.12'
    testCompile "org.assertj:assertj-core:1.7.0"
    testCompile 'org.robolectric:robolectric:3.0'
<span class="org-block-end-line">#+END_SRC
</span>
&#21152;&#20837;&#23436;&#25104;&#21518;, &#25226;Build Variants&#30340; "Test Artifact" &#35774;&#32622;&#20026; <span class="bold">*Unit Tests*</span>.
<span class="org-level-2">** &#32534;&#20889;&#31616;&#21333;&#27979;&#35797;&#20195;&#30721;</span>
&#22312;src&#30446;&#24405;&#19979;&#21019;&#24314;test&#30446;&#24405;, &#28982;&#21518;&#22312;test&#30446;&#24405;&#19979;&#21019;&#24314;&#19982;main&#30456;&#21516;&#30340;package&#30446;&#24405;. 
&#21019;&#24314;TestMainActivity.class&#31867;, &#26469;&#27979;&#35797;MainActivity.
&#22312;&#31867;&#21517;&#30340;&#21069;&#38754;&#21152;&#20837;&#20197;&#19979;&#20004;&#20010;&#27880;&#35299;:
<span class="org-block-begin-line">#+BEGIN_SRC java
</span>   <span class="c-annotation">@RunWith</span>(RobolectricGradleTestRunner.<span class="keyword">class</span>)
   <span class="c-annotation">@Config</span>(constants = BuildConfig.<span class="keyword">class</span>)
   <span class="keyword">public</span> <span class="keyword">class</span> <span class="type">TestMainActivity</span> {
<span class="org-block-end-line">#+END_SRC
</span>&#31532;&#20108;&#20010;&#27880;&#35299;&#24517;&#39035;&#35201;&#23558;constants&#35774;&#32622;&#20026;&#32534;&#35793;&#31995;&#32479;&#29983;&#25104;&#30340;BuildConfig&#25991;&#20214;.

&#21487;&#20197;&#22312;&#31867;&#37324;&#38754;&#26377; @Test &#27880;&#35299;&#32534;&#20889;&#27979;&#35797;&#26041;&#27861;.&#20363;&#22914;:
<span class="org-block-begin-line">#+BEGIN_SRC  java
</span><span class="c-annotation">@RunWith</span>(RobolectricGradleTestRunner.<span class="keyword">class</span>)
<span class="c-annotation">@Config</span>(constants = BuildConfig.<span class="keyword">class</span>)
<span class="keyword">public</span> <span class="keyword">class</span> <span class="type">TestMainActivity</span> {
    <span class="c-annotation">@Test</span>
    <span class="keyword">public</span> <span class="type">void</span> <span class="function-name">init</span>(){
        <span class="type">ActivityController</span> <span class="variable-name">controller</span> = Robolectric.buildActivity(MainActivity.<span class="keyword">class</span>).create().start();
        <span class="type">MainActivity</span> <span class="variable-name">activity</span> = (<span class="type">MainActivity</span>)controller.get();

        controller.resume();

        <span class="type">FloatingActionButton</span> <span class="variable-name">button</span> = (<span class="type">FloatingActionButton</span>)activity.findViewById(R.id.fab);
        button.performClick();

        assertTrue(button.getVisibility() == <span class="constant">View</span>.GONE);
    }
}
<span class="org-block-end-line">#+END_SRC
</span>
&#26368;&#21518;&#21487;&#20197;&#21491;&#38190;&#35813;&#31867;&#28857;&#20987;&#36816;&#34892;&#25110;&#36890;&#36807;gradle&#21629;&#20196;&#26469;&#23454;&#29616;&#36305;&#27979;&#35797;.
<span class="org-level-1">* Robolectric&#25991;&#26723;</span>
<span class="org-level-2">** &#27169;&#25311;Activity&#30340;&#29983;&#21629;&#21608;&#26399;</span>
&#36890;&#36807;ActivityController&#36825;&#20010;API&#21487;&#20197;&#23454;&#29616;&#23545;Activity&#29983;&#21629;&#21608;&#26399;
&#30340;&#25511;&#21046;. &#36890;&#36807;&#20197;&#19979;API&#21487;&#20197;&#33719;&#21462;&#19968;&#20010;ActivityController&#23454;&#20363;&#21270;.
<span class="org-block-begin-line">#+BEGIN_SRC java
</span><span class="type">ActivityController</span> <span class="variable-name">controller</span> = Robolectric.buildActivity(MyAwesomeActivity.<span class="keyword">class</span>).create().start();
<span class="org-block-end-line">#+END_SRC
</span>
controller&#21019;&#24314;&#20986;&#26469;&#20043;&#21518;, &#23601;&#21487;&#20197;&#35843;&#29992;start(), pause(), stop()
&#25110;&#32773;destroy()&#31561;&#20989;&#25968;&#26469;&#27169;&#20223;Activity&#27969;&#31243;, &#20363;&#22914;&#19979;&#38754;&#30340;&#20195;&#30721;&#23601;&#26159;
&#19968;&#20010;&#23436;&#25972;&#30340;activity&#27969;&#31243;:
<span class="org-block-begin-line">#+BEGIN_SRC  java
</span><span class="type">Activity</span> <span class="variable-name">activity</span> = Robolectric.buildActivity(MyAwesomeActivity.<span class="keyword">class</span>).create().start().resume().visible().get();
<span class="org-block-end-line">#+END_SRC
</span>
&#27880;: visible()&#20989;&#25968;&#29992;&#26469;&#27169;&#25311;activity attach&#21040;&#19968;&#20010;&#31383;&#21475;&#30340;&#36807;&#31243;, &#22914;&#26524;&#38656;&#35201;&#20351;&#29992;activity&#20013;
view&#30456;&#20851;&#30340;&#20989;&#25968;, &#24517;&#39035;&#35201;&#20808;&#35843;&#29992;visible().

<span class="org-level-2">** &#29992;Intent &#25110; savedInstanceState&#21551;&#21160;/&#24674;&#22797; Activity</span>
<span class="org-block-begin-line">#+BEGIN_SRC java
</span><span class="comment-delimiter">//</span><span class="comment">intent
</span><span class="type">Intent</span> <span class="variable-name">intent</span> = <span class="keyword">new</span> <span class="type">Intent</span>(<span class="constant">Intent</span>.ACTION_VIEW);
<span class="type">Activity</span> <span class="variable-name">activity</span> = Robolectric.buildActivity(MyAwesomeActivity.<span class="keyword">class</span>).withIntent(intent).create().get();

/bundle
Bundle savedInstanceState = <span class="keyword">new</span> <span class="type">Bundle</span>();
<span class="type">Activity</span> <span class="variable-name">activity</span> = Robolectric.buildActivity(MyAwesomeActivity.<span class="keyword">class</span>)
    .create()
    .restoreInstanceState(savedInstanceState)
    .get();
<span class="org-block-end-line">#+END_SRC
</span></pre>
  </body>
</html>
